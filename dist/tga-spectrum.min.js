!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).TGASpectrum={})}(this,(function(t){"use strict";const e=Object.prototype.toString;function r(t){return e.call(t).endsWith("Array]")}const o=Object.prototype.toString;var n=function(t){return o.call(t).endsWith("Array]")};function s(t){if(!n(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]>e&&(e=t[r]);return e}function i(t){if(!n(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=0,r=0;r<t.length;r++)e+=t[r];return e}function l(t){var e,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=o.algorithm,l=void 0===n?"absolute":n,u=o.sumValue,h=void 0===u?1:u,f=o.maxValue,c=void 0===f?1:f;if(!r(t))throw new Error("input must be an array");if(void 0!==o.output){if(!r(o.output))throw new TypeError("output option must be an array if specified");e=o.output}else e=new Array(t.length);if(0===t.length)throw new Error("input must not be empty");switch(l.toLowerCase()){case"absolute":var m=a(t)/h;if(0===m)return t.slice(0);for(var g=0;g<t.length;g++)e[g]=t[g]/m;return e;case"max":var p=s(t);if(0===p)return t.slice(0);for(var w=c/p,d=0;d<t.length;d++)e[d]=t[d]*w;return e;case"sum":var y=i(t)/h;if(0===y)return t.slice(0);for(var b=0;b<t.length;b++)e[b]=t[b]/y;return e;default:throw new Error("norm: unknown algorithm: ".concat(l))}}function a(t){for(var e=0,r=0;r<t.length;r++)e+=Math.abs(t[r]);return e}function u(t){if(!n(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");for(var e=t[0],r=1;r<t.length;r++)t[r]<e&&(e=t[r]);return e}function h(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!n(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");if(void 0!==r.output){if(!n(r.output))throw new TypeError("output option must be an array if specified");e=r.output}else e=new Array(t.length);var o=u(t),i=s(t);if(o===i)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var l=r.min,a=void 0===l?r.autoMinMax?o:0:l,h=r.max,f=void 0===h?r.autoMinMax?i:1:h;if(a>=f)throw new RangeError("min option must be smaller than max option");for(var c=(f-a)/(i-o),m=0;m<t.length;m++)e[m]=(t[m]-o)*c+a;return e}function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function c(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==f(t)||n(t)||(e=t,t=[]),!n(t))throw new TypeError("input must be an array");var r=e,o=r.from,s=void 0===o?0:o,i=r.to,l=void 0===i?10:i,a=r.size,u=void 0===a?t.length:a,h=r.step;if(u&&h)throw new Error("step is defined by the array size");if(u||(u=h?Math.floor((l-s)/h)+1:l-s+1),!h&&u&&(h=(l-s)/(u-1)),Array.isArray(t)){t.length=0;for(var c=0;c<u;c++)t.push(s),s+=h}else{if(t.length!==u)throw new Error("sequentialFill typed array must have the correct length");for(var m=0;m<u;m++)t[m]=s,s+=h}return t}function m(t=[],e={}){if(0===t.length)return[];let{from:r=Number.NEGATIVE_INFINITY,to:o=Number.POSITIVE_INFINITY}=e;if(r>o&&([r,o]=[o,r]),(t=(t=JSON.parse(JSON.stringify(t)).map(t=>t.from>t.to?{from:t.to,to:t.from}:t)).sort((t,e)=>t.from!==e.from?t.from-e.from:t.to-e.to)).forEach(t=>{r>t.from&&(t.from=r),o<t.to&&(t.to=o)}),0===(t=t.filter(t=>t.from<=t.to)).length)return[];let n=t[0],s=[n];for(let e=1;e<t.length;e++){let r=t[e];r.from<=n.to?n.to=r.to:(n=r,s.push(n))}return s}function g(t,e,r,o){return.5*r*e*e+o*e-(.5*r*t*t+o*t)}function p(t={},e={}){let{x:r,y:o}=t,n=r.length,s=!1;r.length>1&&r[0]>r[1]&&(r=r.slice().reverse(),o=o.slice().reverse(),s=!0);let{from:i=r[0],to:l=r[n-1],variant:a="smooth",numberOfPoints:u=100,exclusions:h=[],zones:f=[]}=e;if(n!==o.length)throw new RangeError("the x and y vector doesn't have the same size.");if("number"!=typeof i||isNaN(i))throw new RangeError("'from' option must be a number");if("number"!=typeof l||isNaN(l))throw new RangeError("'to' option must be a number");if("number"!=typeof u||isNaN(u))throw new RangeError("'numberOfPoints' option must be a number");if(u<2)throw new RangeError("'numberOfPoints' option must be greater than 1");0===f.length&&(f=function(t=[],e={}){let{from:r=Number.NEGATIVE_INFINITY,to:o=Number.POSITIVE_INFINITY}=e;if(r>o&&([r,o]=[o,r]),0===(t=m(t,{from:r,to:o})).length)return[{from:r,to:o}];let n=[];for(let e=0;e<t.length;e++){let s=t[e],i=t[e+1];0===e&&s.from>r&&n.push({from:r,to:s.from}),e===t.length-1?s.to<o&&n.push({from:s.to,to:o}):n.push({from:s.to,to:i.from})}return n}(h,{from:i,to:l})),f=function(t,e,r={}){if(0===t.length)return t;let o=(t=m(t,r)).reduce((t,e)=>t+(e.to-e.from),0)/e,n=0;for(let r=0;r<t.length-1;r++){let s=t[r];s.numberOfPoints=Math.min(Math.round((s.to-s.from)/o),e-n),n+=s.numberOfPoints}return t[t.length-1].numberOfPoints=e-n,t}(f,u,{from:i,to:l});let c=[],g=[];for(let t of f){let e=w(r,o,t.from,t.to,t.numberOfPoints,a);c=c.concat(e.x),g=g.concat(e.y)}return s?i<l?{x:c.reverse(),y:g.reverse()}:{x:c,y:g}:i<l?{x:c,y:g}:{x:c.reverse(),y:g.reverse()}}function w(t,e,r,o,n,s){if(n<1)throw new RangeError("the number of points must be at least 1");let i="slot"===s?function(t,e,r,o,n){let s=t.length,i=(o-r)/(n-1),l=i/2,a=t[t.length-1]-t[t.length-2],u=r-l,h=new Array(n),f=u,c=u+i,m=-Number.MAX_VALUE,g=0,p=t[0],w=e[0],d=0,y=!0,b=0,x=0,v=1,M=0;t:for(;;){if(m>=p)throw new Error("x must be an increasing serie");for(;m-c>0;){if(y&&(x++,y=!1),h[M]=x<=0?0:b/x,M++,M===n)break t;f=c,c+=i,b=0,x=0}m>f&&(b+=g,x++),(m===-Number.MAX_VALUE||d>1)&&x--,m=p,g=w,v<s?(p=t[v],w=e[v],v++):(p+=a,w=0,d++)}return h}(t,e,r,o,n):function(t,e,r,o,n){let s=t.length,i=(o-r)/(n-1),l=i/2,a=new Array(n),u=t[1]-t[0],h=t[s-1]-t[s-2],f=r-l,c=r+l,m=Number.MIN_VALUE,p=0,w=t[0]-u,d=0,y=0,b=0,x=0,v=0,M=0,E=0,S=0,A=0;t:for(;;){for(m<=f&&f<=w&&(A=g(0,f-m,b,p),v=y+A);w-c>=0;){if(A=g(0,c-m,b,p),M=y+A,a[S++]=(M-v)/i,S===n)break t;f=c,c+=i,v=M}y+=g(m,w,b,x),m=w,p=d,E<s?(w=t[E],d=e[E],E++):E===s&&(w+=h,d=0),b=(d-p)/(w-m),x=-b*m+p}return a}(t,e,r,o,n);return{x:c({from:r,to:o,size:n}),y:i}}function d(t,e={}){const{x:r,y:o}=t,{from:n=r[0],to:s=r[r.length-1],exclusions:i=[]}=e;let l=function(t,e,r=[]){t>e&&([t,e]=[e,t]),r=r.filter(t=>void 0!==t.from&&void 0!==t.to),(r=JSON.parse(JSON.stringify(r))).forEach(t=>{t.from>t.to&&([t.to,t.from]=[t.from,t.to])}),r.sort((t,e)=>t.from-e.from),r.forEach(r=>{r.from<t&&(r.from=t),r.to>e&&(r.to=e)});for(let t=0;t<r.length-1;t++)r[t].to>r[t+1].from&&(r[t].to=r[t+1].from);if(!(r=r.filter(t=>t.from<t.to))||0===r.length)return[{from:t,to:e}];let o=[],n=t;for(let t of r)n<t.from&&o.push({from:n,to:t.from}),n=t.to;return n<e&&o.push({from:n,to:e}),o}(n,s,i),a=0,u=[],h=[],f=0;for(;f<r.length;){if(r[f]<=l[a].to&&r[f]>=l[a].from)u.push(r[f]),h.push(o[f]);else if(r[f]>l[a].to&&(a++,!l[a]))break;f++}return{x:u,y:h}}function y(t,e){return t(e={exports:{}},e.exports),e.exports}var b=y((function(t,e){function r(t,e){return t-e}e.sum=function(t){for(var e=0,r=0;r<t.length;r++)e+=t[r];return e},e.max=function(t){for(var e=t[0],r=t.length,o=1;o<r;o++)t[o]>e&&(e=t[o]);return e},e.min=function(t){for(var e=t[0],r=t.length,o=1;o<r;o++)t[o]<e&&(e=t[o]);return e},e.minMax=function(t){for(var e=t[0],r=t[0],o=t.length,n=1;n<o;n++)t[n]<e&&(e=t[n]),t[n]>r&&(r=t[n]);return{min:e,max:r}},e.arithmeticMean=function(t){for(var e=0,r=t.length,o=0;o<r;o++)e+=t[o];return e/r},e.mean=e.arithmeticMean,e.geometricMean=function(t){for(var e=1,r=t.length,o=0;o<r;o++)e*=t[o];return Math.pow(e,1/r)},e.logMean=function(t){for(var e=0,r=t.length,o=0;o<r;o++)e+=Math.log(t[o]);return e/r},e.grandMean=function(t,e){for(var r=0,o=0,n=t.length,s=0;s<n;s++)r+=e[s]*t[s],o+=e[s];return r/o},e.truncatedMean=function(t,e,o){void 0===o&&(o=!1),o||(t=[].concat(t).sort(r));for(var n=t.length,s=Math.floor(n*e),i=0,l=s;l<n-s;l++)i+=t[l];return i/(n-2*s)},e.harmonicMean=function(t){for(var e=0,r=t.length,o=0;o<r;o++){if(0===t[o])throw new RangeError("value at index "+o+"is zero");e+=1/t[o]}return r/e},e.contraHarmonicMean=function(t){for(var e=0,r=0,o=t.length,n=0;n<o;n++)e+=t[n]*t[n],r+=t[n];if(r<0)throw new RangeError("sum of values is negative");return e/r},e.median=function(t,e){void 0===e&&(e=!1),e||(t=[].concat(t).sort(r));var o=t.length,n=Math.floor(o/2);return o%2==0?.5*(t[n-1]+t[n]):t[n]},e.variance=function(t,r){void 0===r&&(r=!0);for(var o=e.mean(t),n=0,s=t.length,i=0;i<s;i++){var l=t[i]-o;n+=l*l}return r?n/(s-1):n/s},e.standardDeviation=function(t,r){return Math.sqrt(e.variance(t,r))},e.standardError=function(t){return e.standardDeviation(t)/Math.sqrt(t.length)},e.robustMeanAndStdev=function(t){var e=0,o=t.length,n=0;for(n=0;n<o;n++)e+=t[n];e/=o;var s=new Array(o);for(n=0;n<o;n++)s[n]=Math.abs(t[n]-e);return s.sort(r),{mean:e,stdev:o%2==1?s[(o-1)/2]/.6745:.5*(s[o/2]+s[o/2-1])/.6745}},e.quartiles=function(t,o){void 0===o&&(o=!1),o||(t=[].concat(t).sort(r));var n=t.length/4;return{q1:t[Math.ceil(n)-1],q2:e.median(t,!0),q3:t[Math.ceil(3*n)-1]}},e.pooledStandardDeviation=function(t,r){return Math.sqrt(e.pooledVariance(t,r))},e.pooledVariance=function(t,r){void 0===r&&(r=!0);for(var o=0,n=0,s=t.length,i=0;i<s;i++){var l=t[i],a=e.variance(l);o+=(l.length-1)*a,n+=r?l.length-1:l.length}return o/n},e.mode=function(t){var e,r=t.length,o=new Array(r);for(e=0;e<r;e++)o[e]=0;var n=new Array(r),s=0;for(e=0;e<r;e++){var i=n.indexOf(t[e]);i>=0?o[i]++:(n[s]=t[e],o[s]=1,s++)}var l=0,a=0;for(e=0;e<s;e++)o[e]>l&&(l=o[e],a=e);return n[a]},e.covariance=function(t,r,o){void 0===o&&(o=!0);var n=e.mean(t),s=e.mean(r);if(t.length!==r.length)throw"Vectors do not have the same dimensions";for(var i=0,l=t.length,a=0;a<l;a++){i+=(t[a]-n)*(r[a]-s)}return o?i/(l-1):i/l},e.skewness=function(t,r){void 0===r&&(r=!0);for(var o=e.mean(t),n=0,s=0,i=t.length,l=0;l<i;l++){var a=t[l]-o;n+=a*a,s+=a*a*a}var u=n/i,h=s/i/Math.pow(u,1.5);return r?Math.sqrt(i*(i-1))/(i-2)*h:h},e.kurtosis=function(t,r){void 0===r&&(r=!0);for(var o=e.mean(t),n=t.length,s=0,i=0,l=0;l<n;l++){var a=t[l]-o;s+=a*a,i+=a*a*a*a}var u=s/n;if(r){var h=s/(n-1);return n*(n+1)/((n-1)*(n-2)*(n-3))*(i/(h*h))-3*((n-1)*(n-1)/((n-2)*(n-3)))}return i/n/(u*u)-3},e.entropy=function(t,e){void 0===e&&(e=0);for(var r=0,o=t.length,n=0;n<o;n++)r+=t[n]*Math.log(t[n]+e);return-r},e.weightedMean=function(t,e){for(var r=0,o=t.length,n=0;n<o;n++)r+=t[n]*e[n];return r},e.weightedStandardDeviation=function(t,r){return Math.sqrt(e.weightedVariance(t,r))},e.weightedVariance=function(t,r){for(var o=e.weightedMean(t,r),n=0,s=t.length,i=0,l=0,a=0;a<s;a++){var u=t[a]-o,h=r[a];n+=h*(u*u),l+=h,i+=h*h}return n*(l/(l*l-i))},e.center=function(t,r){void 0===r&&(r=!1);var o=t;r||(o=[].concat(t));for(var n=e.mean(o),s=o.length,i=0;i<s;i++)o[i]-=n},e.standardize=function(t,r,o){void 0===r&&(r=e.standardDeviation(t)),void 0===o&&(o=!1);for(var n=t.length,s=o?t:new Array(n),i=0;i<n;i++)s[i]=t[i]/r;return s},e.cumulativeSum=function(t){var e=t.length,r=new Array(e);r[0]=t[0];for(var o=1;o<e;o++)r[o]=r[o-1]+t[o];return r}}));b.sum,b.max,b.min,b.minMax,b.arithmeticMean,b.mean,b.geometricMean,b.logMean,b.grandMean,b.truncatedMean,b.harmonicMean,b.contraHarmonicMean,b.median,b.variance,b.standardDeviation,b.standardError,b.robustMeanAndStdev,b.quartiles,b.pooledStandardDeviation,b.pooledVariance,b.mode,b.covariance,b.skewness,b.kurtosis,b.entropy,b.weightedMean,b.weightedStandardDeviation,b.weightedVariance,b.center,b.standardize,b.cumulativeSum;function x(t,e){let r=0,o=t.length-1,n=0;for(;o-r>1;)if(n=r+(o-r>>1),t[n]<e)r=n;else{if(!(t[n]>e))return n;o=n}return r<t.length-1?Math.abs(e-t[r])<Math.abs(t[r+1]-e)?r:r+1:r}function v(t,e){let r,o=!1;if(Array.isArray(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,r=Number(e);let n=new Float64Array(t.length);if(o)for(let e=0;e<t.length;e++)n[e]=t[e]*r;else for(let r=0;r<t.length;r++)n[r]=t[r]*e[r];return n}function M(t,e){let r=v(t,e),o=0;for(let e=0;e<t.length;e++)o+=r[e];return o}function E(t,e,r={}){let{tau:o=1,lag:n=t.length-1}=r,s=new Float64Array(1+2*n/o);if(t.length===e.length){let r=e.length,i=new Float64Array(2*r),l=new Float64Array(2*r);for(let t=0;t<r;t++)l[r+t]=e[t];for(let e=2*r-(o-1);e>0;e-=o){let a=0;for(let t=e;t<2*r;t++)i[a]=l[t],a++;let u=[];for(let t=0;t<r;t++)u[t]=i[t];s[(a-(r-n))/o]=M(t,u)}}return s}const S={add:function(t,e){let r,o=!1;if(Array.isArray(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,r=Number(e);let n=new Array(t.length);if(o)for(let e=0;e<t.length;e++)n[e]=t[e]+r;else for(let r=0;r<t.length;r++)n[r]=t[r]+e[r];return n},autoCorrelation:function(t,e={}){return E(t,t,e)},boxPlot:function(t){if((t=t.slice(0).sort((t,e)=>t-e)).length<5)throw Error("boxPlot: can not calculate info if array contains less than 3 elements");let e,r,o={Q1:0,Q2:0,Q3:0,min:t[0],max:t[t.length-1]};if(t.length%2==1){let n=(t.length-1)/2;o.Q2=t[n],e=n-1,r=n+1}else r=t.length/2,e=r-1,o.Q2=(t[e]+t[r])/2;if(e%2==0)o.Q1=t[e/2],o.Q3=t[(t.length+r-1)/2];else{o.Q1=(t[(e+1)/2]+t[(e-1)/2])/2;let n=(t.length+r)/2;o.Q3=(t[n]+t[n-1])/2}return o},correlation:function(t,e){let r=t.length,o=0,n=0,s=0,i=0,l=0;for(let a=0;a<r;a++){let r=t[a],u=e[a];o+=r,n+=r**2,s+=u,i+=u**2,l+=r*u}return(r*l-o*s)/(Math.sqrt(r*n-o**2)*Math.sqrt(r*i-s**2))},crossCorrelation:E,divide:function(t,e){let r,o=!1;if(Array.isArray(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,r=Number(e);let n=new Array(t.length);if(o)for(let e=0;e<t.length;e++)n[e]=t[e]/r;else for(let r=0;r<t.length;r++)n[r]=t[r]/e[r];return n},findClosestIndex:x,getFromToIndex:function(t,e={}){let{fromIndex:r,toIndex:o,from:n,to:s}=e;return void 0===r&&(r=void 0!==n?x(t,n):0),void 0===o&&(o=void 0!==s?x(t,s):t.length-1),r>o&&([r,o]=[o,r]),{fromIndex:r,toIndex:o}},getTargetIndex:function(t,e={}){let{target:r,targetIndex:o}=e;return void 0===o?void 0!==r?x(t,r):0:o},multiply:v,rotate:function(t,e){return(e%=t.length)<0&&(e+=t.length),t.slice(t.length-e).concat(t.slice(0,t.length-e))},subtract:function(t,e){let r,o=!1;if(Array.isArray(e)){if(t.length!==e.length)throw new Error("sub: size of array1 and array2 must be identical")}else o=!0,r=Number(e);let n=new Array(t.length);if(o)for(let e=0;e<t.length;e++)n[e]=t[e]-r;else for(let r=0;r<t.length;r++)n[r]=t[r]-e[r];return n}};function A(t,e,r){let o=r?t.rows:t.rows-1;if(e<0||e>o)throw new RangeError("Row index out of range")}function T(t,e,r){let o=r?t.columns:t.columns-1;if(e<0||e>o)throw new RangeError("Column index out of range")}function R(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.columns)throw new RangeError("vector size must be the same as the number of columns");return e}function N(t,e){if(e.to1DArray&&(e=e.to1DArray()),e.length!==t.rows)throw new RangeError("vector size must be the same as the number of rows");return e}function F(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for row indices");if(e.some(e=>e<0||e>=t.rows))throw new RangeError("row indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function I(t,e){if("object"!=typeof e)throw new TypeError("unexpected type for column indices");if(e.some(e=>e<0||e>=t.columns))throw new RangeError("column indices are out of range");return Array.isArray(e)||(e=Array.from(e)),e}function z(t,e,r,o,n){if(5!==arguments.length)throw new RangeError("expected 4 arguments");if(V("startRow",e),V("endRow",r),V("startColumn",o),V("endColumn",n),e>r||o>n||e<0||e>=t.rows||r<0||r>=t.rows||o<0||o>=t.columns||n<0||n>=t.columns)throw new RangeError("Submatrix indices are out of range")}function k(t,e=0){let r=[];for(let o=0;o<t;o++)r.push(e);return r}function V(t,e){if("number"!=typeof e)throw new TypeError("".concat(t," must be a number"))}function O(t){const e=String(t);if(e.length<=8)return e.padEnd(8," ");const r=t.toPrecision(6);if(r.length<=8)return r;const o=t.toExponential(6),n=o.indexOf("e"),s=o.substring(n);return o.substring(0,8-s.length)+s}class X{static from1DArray(t,e,r){if(t*e!==r.length)throw new RangeError("data length does not match given dimensions");let o=new L(t,e);for(let n=0;n<t;n++)for(let t=0;t<e;t++)o.set(n,t,r[n*e+t]);return o}static rowVector(t){let e=new L(1,t.length);for(let r=0;r<t.length;r++)e.set(0,r,t[r]);return e}static columnVector(t){let e=new L(t.length,1);for(let r=0;r<t.length;r++)e.set(r,0,t[r]);return e}static zeros(t,e){return new L(t,e)}static ones(t,e){return new L(t,e).fill(1)}static rand(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{random:o=Math.random}=r;let n=new L(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++)n.set(r,t,o());return n}static randInt(t,e,r={}){if("object"!=typeof r)throw new TypeError("options must be an object");const{min:o=0,max:n=1e3,random:s=Math.random}=r;if(!Number.isInteger(o))throw new TypeError("min must be an integer");if(!Number.isInteger(n))throw new TypeError("max must be an integer");if(o>=n)throw new RangeError("min must be smaller than max");let i=n-o,l=new L(t,e);for(let r=0;r<t;r++)for(let t=0;t<e;t++){let e=o+Math.round(s()*i);l.set(r,t,e)}return l}static eye(t,e,r){void 0===e&&(e=t),void 0===r&&(r=1);let o=Math.min(t,e),n=this.zeros(t,e);for(let t=0;t<o;t++)n.set(t,t,r);return n}static diag(t,e,r){let o=t.length;void 0===e&&(e=o),void 0===r&&(r=e);let n=Math.min(o,e,r),s=this.zeros(e,r);for(let e=0;e<n;e++)s.set(e,e,t[e]);return s}static min(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,n=new L(r,o);for(let s=0;s<r;s++)for(let r=0;r<o;r++)n.set(s,r,Math.min(t.get(s,r),e.get(s,r)));return n}static max(t,e){t=this.checkMatrix(t),e=this.checkMatrix(e);let r=t.rows,o=t.columns,n=new this(r,o);for(let s=0;s<r;s++)for(let r=0;r<o;r++)n.set(s,r,Math.max(t.get(s,r),e.get(s,r)));return n}static checkMatrix(t){return X.isMatrix(t)?t:new L(t)}static isMatrix(t){return null!=t&&"Matrix"===t.klass}get size(){return this.rows*this.columns}apply(t){if("function"!=typeof t)throw new TypeError("callback must be a function");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.call(this,e,r);return this}to1DArray(){let t=[];for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.push(this.get(e,r));return t}to2DArray(){let t=[];for(let e=0;e<this.rows;e++){t.push([]);for(let r=0;r<this.columns;r++)t[e].push(this.get(e,r))}return t}toJSON(){return this.to2DArray()}isRowVector(){return 1===this.rows}isColumnVector(){return 1===this.columns}isVector(){return 1===this.rows||1===this.columns}isSquare(){return this.rows===this.columns}isSymmetric(){if(this.isSquare()){for(let t=0;t<this.rows;t++)for(let e=0;e<=t;e++)if(this.get(t,e)!==this.get(e,t))return!1;return!0}return!1}isEchelonForm(){let t=0,e=0,r=-1,o=!0,n=!1;for(;t<this.rows&&o;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(o=!1,n=!0);t++}return o}isReducedEchelonForm(){let t=0,e=0,r=-1,o=!0,n=!1;for(;t<this.rows&&o;){for(e=0,n=!1;e<this.columns&&!1===n;)0===this.get(t,e)?e++:1===this.get(t,e)&&e>r?(n=!0,r=e):(o=!1,n=!0);for(let r=e+1;r<this.rows;r++)0!==this.get(t,r)&&(o=!1);t++}return o}echelonForm(){let t=this.clone(),e=0,r=0;for(;e<t.rows&&r<t.columns;){let o=e;for(let n=e;n<t.rows;n++)t.get(n,r)>t.get(o,r)&&(o=n);if(0===t.get(o,r))r++;else{t.swapRows(e,o);let n=t.get(e,r);for(let o=r;o<t.columns;o++)t.set(e,o,t.get(e,o)/n);for(let o=e+1;o<t.rows;o++){let n=t.get(o,r)/t.get(e,r);t.set(o,r,0);for(let s=r+1;s<t.columns;s++)t.set(o,s,t.get(o,s)-t.get(e,s)*n)}e++,r++}}return t}reducedEchelonForm(){let t=this.echelonForm(),e=t.columns,r=t.rows,o=r-1;for(;o>=0;)if(0===t.maxRow(o))o--;else{let n=0,s=!1;for(;n<r&&!1===s;)1===t.get(o,n)?s=!0:n++;for(let r=0;r<o;r++){let s=t.get(r,n);for(let i=n;i<e;i++){let e=t.get(r,i)-s*t.get(o,i);t.set(r,i,e)}}o--}return t}set(){throw new Error("set method is unimplemented")}get(){throw new Error("get method is unimplemented")}repeat(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{rows:e=1,columns:r=1}=t;if(!Number.isInteger(e)||e<=0)throw new TypeError("rows must be a positive integer");if(!Number.isInteger(r)||r<=0)throw new TypeError("columns must be a positive integer");let o=new L(this.rows*e,this.columns*r);for(let t=0;t<e;t++)for(let e=0;e<r;e++)o.setSubMatrix(this,this.rows*t,this.columns*e);return o}fill(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,t);return this}neg(){return this.mulS(-1)}getRow(t){A(this,t);let e=[];for(let r=0;r<this.columns;r++)e.push(this.get(t,r));return e}getRowVector(t){return L.rowVector(this.getRow(t))}setRow(t,e){A(this,t),e=R(this,e);for(let r=0;r<this.columns;r++)this.set(t,r,e[r]);return this}swapRows(t,e){A(this,t),A(this,e);for(let r=0;r<this.columns;r++){let o=this.get(t,r);this.set(t,r,this.get(e,r)),this.set(e,r,o)}return this}getColumn(t){T(this,t);let e=[];for(let r=0;r<this.rows;r++)e.push(this.get(r,t));return e}getColumnVector(t){return L.columnVector(this.getColumn(t))}setColumn(t,e){T(this,t),e=N(this,e);for(let r=0;r<this.rows;r++)this.set(r,t,e[r]);return this}swapColumns(t,e){T(this,t),T(this,e);for(let r=0;r<this.rows;r++){let o=this.get(r,t);this.set(r,t,this.get(r,e)),this.set(r,e,o)}return this}addRowVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[r]);return this}subRowVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[r]);return this}mulRowVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[r]);return this}divRowVector(t){t=R(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[r]);return this}addColumnVector(t){t=N(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t[e]);return this}subColumnVector(t){t=N(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t[e]);return this}mulColumnVector(t){t=N(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t[e]);return this}divColumnVector(t){t=N(this,t);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t[e]);return this}mulRow(t,e){A(this,t);for(let r=0;r<this.columns;r++)this.set(t,r,this.get(t,r)*e);return this}mulColumn(t,e){T(this,t);for(let r=0;r<this.rows;r++)this.set(r,t,this.get(r,t)*e);return this}max(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)>t&&(t=this.get(e,r));return t}maxIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)>t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}min(){let t=this.get(0,0);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.get(e,r)<t&&(t=this.get(e,r));return t}minIndex(){let t=this.get(0,0),e=[0,0];for(let r=0;r<this.rows;r++)for(let o=0;o<this.columns;o++)this.get(r,o)<t&&(t=this.get(r,o),e[0]=r,e[1]=o);return e}maxRow(t){A(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)>e&&(e=this.get(t,r));return e}maxRowIndex(t){A(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)>e&&(e=this.get(t,o),r[1]=o);return r}minRow(t){A(this,t);let e=this.get(t,0);for(let r=1;r<this.columns;r++)this.get(t,r)<e&&(e=this.get(t,r));return e}minRowIndex(t){A(this,t);let e=this.get(t,0),r=[t,0];for(let o=1;o<this.columns;o++)this.get(t,o)<e&&(e=this.get(t,o),r[1]=o);return r}maxColumn(t){T(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)>e&&(e=this.get(r,t));return e}maxColumnIndex(t){T(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)>e&&(e=this.get(o,t),r[0]=o);return r}minColumn(t){T(this,t);let e=this.get(0,t);for(let r=1;r<this.rows;r++)this.get(r,t)<e&&(e=this.get(r,t));return e}minColumnIndex(t){T(this,t);let e=this.get(0,t),r=[0,t];for(let o=1;o<this.rows;o++)this.get(o,t)<e&&(e=this.get(o,t),r[0]=o);return r}diag(){let t=Math.min(this.rows,this.columns),e=[];for(let r=0;r<t;r++)e.push(this.get(r,r));return e}norm(t="frobenius"){let e=0;if("max"===t)return this.max();if("frobenius"===t){for(let t=0;t<this.rows;t++)for(let r=0;r<this.columns;r++)e+=this.get(t,r)*this.get(t,r);return Math.sqrt(e)}throw new RangeError("unknown norm type: ".concat(t))}cumulativeSum(){let t=0;for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t+=this.get(e,r),this.set(e,r,t);return this}dot(t){X.isMatrix(t)&&(t=t.to1DArray());let e=this.to1DArray();if(e.length!==t.length)throw new RangeError("vectors do not have the same size");let r=0;for(let o=0;o<e.length;o++)r+=e[o]*t[o];return r}mmul(t){t=L.checkMatrix(t);let e=this.rows,r=this.columns,o=t.columns,n=new L(e,o),s=new Float64Array(r);for(let i=0;i<o;i++){for(let e=0;e<r;e++)s[e]=t.get(e,i);for(let t=0;t<e;t++){let e=0;for(let o=0;o<r;o++)e+=this.get(t,o)*s[o];n.set(t,i,e)}}return n}strassen2x2(t){t=L.checkMatrix(t);let e=new L(2,2);const r=this.get(0,0),o=t.get(0,0),n=this.get(0,1),s=t.get(0,1),i=this.get(1,0),l=t.get(1,0),a=this.get(1,1),u=t.get(1,1),h=(r+a)*(o+u),f=(i+a)*o,c=r*(s-u),m=a*(l-o),g=(r+n)*u,p=h+m-g+(n-a)*(l+u),w=c+g,d=f+m,y=h-f+c+(i-r)*(o+s);return e.set(0,0,p),e.set(0,1,w),e.set(1,0,d),e.set(1,1,y),e}strassen3x3(t){t=L.checkMatrix(t);let e=new L(3,3);const r=this.get(0,0),o=this.get(0,1),n=this.get(0,2),s=this.get(1,0),i=this.get(1,1),l=this.get(1,2),a=this.get(2,0),u=this.get(2,1),h=this.get(2,2),f=t.get(0,0),c=t.get(0,1),m=t.get(0,2),g=t.get(1,0),p=t.get(1,1),w=t.get(1,2),d=t.get(2,0),y=t.get(2,1),b=t.get(2,2),x=(r-s)*(-c+p),v=(-r+s+i)*(f-c+p),M=(s+i)*(-f+c),E=r*f,S=(-r+a+u)*(f-m+w),A=(-r+a)*(m-w),T=(a+u)*(-f+m),R=(-n+u+h)*(p+d-y),N=(n-h)*(p-y),F=n*d,I=(u+h)*(-d+y),z=(-n+i+l)*(w+d-b),k=(n-l)*(w-b),V=(i+l)*(-d+b),O=E+F+o*g,X=(r+o+n-s-i-u-h)*p+v+M+E+R+F+I,C=E+S+T+(r+o+n-i-l-a-u)*w+F+z+V,D=x+i*(-f+c+g-p-w-d+b)+v+E+F+z+k,P=x+v+M+E+l*y,q=F+z+k+V+s*m,Y=E+S+A+u*(-f+m+g-p-w-d+y)+R+N+F,U=R+N+F+I+a*c,j=E+S+A+T+h*b;return e.set(0,0,O),e.set(0,1,X),e.set(0,2,C),e.set(1,0,D),e.set(1,1,P),e.set(1,2,q),e.set(2,0,Y),e.set(2,1,U),e.set(2,2,j),e}mmulStrassen(t){t=L.checkMatrix(t);let e=this.clone(),r=e.rows,o=e.columns,n=t.rows,s=t.columns;function i(t,e,r){let o=t.rows,n=t.columns;if(o===e&&n===r)return t;{let o=X.zeros(e,r);return o=o.setSubMatrix(t,0,0),o}}o!==n&&console.warn("Multiplying ".concat(r," x ").concat(o," and ").concat(n," x ").concat(s," matrix: dimensions do not match."));let l=Math.max(r,n),a=Math.max(o,s);return e=i(e,l,a),function t(e,r,o,n){if(o<=512||n<=512)return e.mmul(r);o%2==1&&n%2==1?(e=i(e,o+1,n+1),r=i(r,o+1,n+1)):o%2==1?(e=i(e,o+1,n),r=i(r,o+1,n)):n%2==1&&(e=i(e,o,n+1),r=i(r,o,n+1));let s=parseInt(e.rows/2,10),l=parseInt(e.columns/2,10),a=e.subMatrix(0,s-1,0,l-1),u=r.subMatrix(0,s-1,0,l-1),h=e.subMatrix(0,s-1,l,e.columns-1),f=r.subMatrix(0,s-1,l,r.columns-1),c=e.subMatrix(s,e.rows-1,0,l-1),m=r.subMatrix(s,r.rows-1,0,l-1),g=e.subMatrix(s,e.rows-1,l,e.columns-1),p=r.subMatrix(s,r.rows-1,l,r.columns-1),w=t(X.add(a,g),X.add(u,p),s,l),d=t(X.add(c,g),u,s,l),y=t(a,X.sub(f,p),s,l),b=t(g,X.sub(m,u),s,l),x=t(X.add(a,h),p,s,l),v=t(X.sub(c,a),X.add(u,f),s,l),M=t(X.sub(h,g),X.add(m,p),s,l),E=X.add(w,b);E.sub(x),E.add(M);let S=X.add(y,x),A=X.add(d,b),T=X.sub(w,d);T.add(y),T.add(v);let R=X.zeros(2*E.rows,2*E.columns);return R=R.setSubMatrix(E,0,0),R=R.setSubMatrix(S,E.rows,0),R=R.setSubMatrix(A,0,E.columns),R=R.setSubMatrix(T,E.rows,E.columns),R.subMatrix(0,o-1,0,n-1)}(e,t=i(t,l,a),l,a)}scaleRows(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new L(this.rows,this.columns);for(let t=0;t<this.rows;t++){const n=this.getRow(t);h(n,{min:e,max:r,output:n}),o.setRow(t,n)}return o}scaleColumns(t={}){if("object"!=typeof t)throw new TypeError("options must be an object");const{min:e=0,max:r=1}=t;if(!Number.isFinite(e))throw new TypeError("min must be a number");if(!Number.isFinite(r))throw new TypeError("max must be a number");if(e>=r)throw new RangeError("min must be smaller than max");let o=new L(this.rows,this.columns);for(let t=0;t<this.columns;t++){const n=this.getColumn(t);h(n,{min:e,max:r,output:n}),o.setColumn(t,n)}return o}flipRows(){const t=Math.ceil(this.columns/2);for(let e=0;e<this.rows;e++)for(let r=0;r<t;r++){let t=this.get(e,r),o=this.get(e,this.columns-1-r);this.set(e,r,o),this.set(e,this.columns-1-r,t)}return this}flipColumns(){const t=Math.ceil(this.rows/2);for(let e=0;e<this.columns;e++)for(let r=0;r<t;r++){let t=this.get(r,e),o=this.get(this.rows-1-r,e);this.set(r,e,o),this.set(this.rows-1-r,e,t)}return this}kroneckerProduct(t){t=L.checkMatrix(t);let e=this.rows,r=this.columns,o=t.rows,n=t.columns,s=new L(e*o,r*n);for(let i=0;i<e;i++)for(let e=0;e<r;e++)for(let r=0;r<o;r++)for(let l=0;l<n;l++)s.set(o*i+r,n*e+l,this.get(i,e)*t.get(r,l));return s}transpose(){let t=new L(this.columns,this.rows);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(r,e,this.get(e,r));return t}sortRows(t=C){for(let e=0;e<this.rows;e++)this.setRow(e,this.getRow(e).sort(t));return this}sortColumns(t=C){for(let e=0;e<this.columns;e++)this.setColumn(e,this.getColumn(e).sort(t));return this}subMatrix(t,e,r,o){z(this,t,e,r,o);let n=new L(e-t+1,o-r+1);for(let s=t;s<=e;s++)for(let e=r;e<=o;e++)n.set(s-t,e-r,this.get(s,e));return n}subMatrixRow(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.columns-1),e>r||e<0||e>=this.columns||r<0||r>=this.columns)throw new RangeError("Argument out of range");let o=new L(t.length,r-e+1);for(let n=0;n<t.length;n++)for(let s=e;s<=r;s++){if(t[n]<0||t[n]>=this.rows)throw new RangeError("Row index out of range: ".concat(t[n]));o.set(n,s-e,this.get(t[n],s))}return o}subMatrixColumn(t,e,r){if(void 0===e&&(e=0),void 0===r&&(r=this.rows-1),e>r||e<0||e>=this.rows||r<0||r>=this.rows)throw new RangeError("Argument out of range");let o=new L(r-e+1,t.length);for(let n=0;n<t.length;n++)for(let s=e;s<=r;s++){if(t[n]<0||t[n]>=this.columns)throw new RangeError("Column index out of range: ".concat(t[n]));o.set(s-e,n,this.get(s,t[n]))}return o}setSubMatrix(t,e,r){z(this,e,e+(t=L.checkMatrix(t)).rows-1,r,r+t.columns-1);for(let o=0;o<t.rows;o++)for(let n=0;n<t.columns;n++)this.set(e+o,r+n,t.get(o,n));return this}selection(t,e){let r=function(t,e,r){return{row:F(t,e),column:I(t,r)}}(this,t,e),o=new L(t.length,e.length);for(let t=0;t<r.row.length;t++){let e=r.row[t];for(let n=0;n<r.column.length;n++){let s=r.column[n];o.set(t,n,this.get(e,s))}}return o}trace(){let t=Math.min(this.rows,this.columns),e=0;for(let r=0;r<t;r++)e+=this.get(r,r);return e}clone(){let t=new L(this.rows,this.columns);for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)t.set(e,r,this.get(e,r));return t}sum(t){switch(t){case"row":return function(t){let e=k(t.rows);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]+=t.get(r,o);return e}(this);case"column":return function(t){let e=k(t.columns);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]+=t.get(r,o);return e}(this);case void 0:return function(t){let e=0;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e+=t.get(r,o);return e}(this);default:throw new Error("invalid option: ".concat(t))}}product(t){switch(t){case"row":return function(t){let e=k(t.rows,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[r]*=t.get(r,o);return e}(this);case"column":return function(t){let e=k(t.columns,1);for(let r=0;r<t.rows;++r)for(let o=0;o<t.columns;++o)e[o]*=t.get(r,o);return e}(this);case void 0:return function(t){let e=1;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e*=t.get(r,o);return e}(this);default:throw new Error("invalid option: ".concat(t))}}mean(t){const e=this.sum(t);switch(t){case"row":for(let t=0;t<this.rows;t++)e[t]/=this.columns;return e;case"column":for(let t=0;t<this.columns;t++)e[t]/=this.rows;return e;case void 0:return e/this.size;default:throw new Error("invalid option: ".concat(t))}}variance(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{unbiased:r=!0,mean:o=this.mean(t)}=e;if("boolean"!=typeof r)throw new TypeError("unbiased must be a boolean");switch(t){case"row":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,n=t.columns,s=[];for(let i=0;i<o;i++){let o=0,l=0,a=0;for(let e=0;e<n;e++)a=t.get(i,e)-r[i],o+=a,l+=a*a;e?s.push((l-o*o/n)/(n-1)):s.push((l-o*o/n)/n)}return s}(this,r,o);case"column":if(!Array.isArray(o))throw new TypeError("mean must be an array");return function(t,e,r){const o=t.rows,n=t.columns,s=[];for(let i=0;i<n;i++){let n=0,l=0,a=0;for(let e=0;e<o;e++)a=t.get(e,i)-r[i],n+=a,l+=a*a;e?s.push((l-n*n/o)/(o-1)):s.push((l-n*n/o)/o)}return s}(this,r,o);case void 0:if("number"!=typeof o)throw new TypeError("mean must be a number");return function(t,e,r){const o=t.rows,n=t.columns,s=o*n;let i=0,l=0,a=0;for(let e=0;e<o;e++)for(let o=0;o<n;o++)a=t.get(e,o)-r,i+=a,l+=a*a;return e?(l-i*i/s)/(s-1):(l-i*i/s)/s}(this,r,o);default:throw new Error("invalid option: ".concat(t))}}standardDeviation(t,e){"object"==typeof t&&(e=t,t=void 0);const r=this.variance(t,e);if(void 0===t)return Math.sqrt(r);for(let t=0;t<r.length;t++)r[t]=Math.sqrt(r[t]);return r}center(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");const{center:r=this.mean(t)}=e;switch(t){case"row":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[r])}(this,r),this;case"column":if(!Array.isArray(r))throw new TypeError("center must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e[o])}(this,r),this;case void 0:if("number"!=typeof r)throw new TypeError("center must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)-e)}(this,r),this;default:throw new Error("invalid option: ".concat(t))}}scale(t,e={}){if("object"==typeof t&&(e=t,t=void 0),"object"!=typeof e)throw new TypeError("options must be an object");let r=e.scale;switch(t){case"row":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.rows;r++){let o=0;for(let e=0;e<t.columns;e++)o+=Math.pow(t.get(r,e),2)/(t.columns-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[r])}(this,r),this;case"column":if(void 0===r)r=function(t){const e=[];for(let r=0;r<t.columns;r++){let o=0;for(let e=0;e<t.rows;e++)o+=Math.pow(t.get(e,r),2)/(t.rows-1);e.push(Math.sqrt(o))}return e}(this);else if(!Array.isArray(r))throw new TypeError("scale must be an array");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e[o])}(this,r),this;case void 0:if(void 0===r)r=function(t){const e=t.size-1;let r=0;for(let o=0;o<t.columns;o++)for(let n=0;n<t.rows;n++)r+=Math.pow(t.get(n,o),2)/e;return Math.sqrt(r)}(this);else if("number"!=typeof r)throw new TypeError("scale must be a number");return function(t,e){for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)t.set(r,o,t.get(r,o)/e)}(this,r),this;default:throw new Error("invalid option: ".concat(t))}}}function C(t,e){return t-e}X.prototype.klass="Matrix","undefined"!=typeof Symbol&&(X.prototype[Symbol.for("nodejs.util.inspect.custom")]=function(){const t=" ".repeat(2),e=" ".repeat(4);return"".concat(this.constructor.name," {\n").concat(t,"[\n").concat(e).concat(function(t,e){const{rows:r,columns:o}=t,n=Math.min(r,15),s=Math.min(o,10),i=[];for(let e=0;e<n;e++){let r=[];for(let o=0;o<s;o++)r.push(O(t.get(e,o)));i.push("".concat(r.join(" ")))}s!==o&&(i[i.length-1]+=" ... ".concat(o-10," more columns"));n!==r&&i.push("... ".concat(r-15," more rows"));return i.join("\n".concat(e))}(this,e),"\n").concat(t,"]\n").concat(t,"rows: ").concat(this.rows,"\n").concat(t,"columns: ").concat(this.columns,"\n}")}),X.random=X.rand,X.randomInt=X.randInt,X.diagonal=X.diag,X.prototype.diagonal=X.prototype.diag,X.identity=X.eye,X.prototype.negate=X.prototype.neg,X.prototype.tensorProduct=X.prototype.kroneckerProduct;class L extends X{constructor(t,e){if(super(),L.isMatrix(t))return t.clone();if(Number.isInteger(t)&&t>0){if(this.data=[],!(Number.isInteger(e)&&e>0))throw new TypeError("nColumns must be a positive integer");for(let r=0;r<t;r++)this.data.push(new Float64Array(e))}else{if(!Array.isArray(t))throw new TypeError("First argument must be a positive number or an array");{const r=t;if(t=r.length,"number"!=typeof(e=r[0].length)||0===e)throw new TypeError("Data must be a 2D array with at least one element");this.data=[];for(let o=0;o<t;o++){if(r[o].length!==e)throw new RangeError("Inconsistent array dimensions");this.data.push(Float64Array.from(r[o]))}}}return this.rows=t,this.columns=e,this}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}removeRow(t){if(A(this,t),1===this.rows)throw new RangeError("A matrix cannot have less than one row");return this.data.splice(t,1),this.rows-=1,this}addRow(t,e){return void 0===e&&(e=t,t=this.rows),A(this,t,!0),e=Float64Array.from(R(this,e)),this.data.splice(t,0,e),this.rows+=1,this}removeColumn(t){if(T(this,t),1===this.columns)throw new RangeError("A matrix cannot have less than one column");for(let e=0;e<this.rows;e++){const r=new Float64Array(this.columns-1);for(let o=0;o<t;o++)r[o]=this.data[e][o];for(let o=t+1;o<this.columns;o++)r[o-1]=this.data[e][o];this.data[e]=r}return this.columns-=1,this}addColumn(t,e){void 0===e&&(e=t,t=this.columns),T(this,t,!0),e=N(this,e);for(let r=0;r<this.rows;r++){const o=new Float64Array(this.columns+1);let n=0;for(;n<t;n++)o[n]=this.data[r][n];for(o[n++]=e[r];n<this.columns+1;n++)o[n]=this.data[r][n-1];this.data[r]=o}return this.columns+=1,this}}!function(t,e){t.prototype.add=function(t){return"number"==typeof t?this.addS(t):this.addM(t)},t.prototype.addS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t);return this},t.prototype.addM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)+t.get(e,r));return this},t.add=function(t,r){return new e(t).add(r)},t.prototype.sub=function(t){return"number"==typeof t?this.subS(t):this.subM(t)},t.prototype.subS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t);return this},t.prototype.subM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)-t.get(e,r));return this},t.sub=function(t,r){return new e(t).sub(r)},t.prototype.subtract=t.prototype.sub,t.prototype.subtractS=t.prototype.subS,t.prototype.subtractM=t.prototype.subM,t.subtract=t.sub,t.prototype.mul=function(t){return"number"==typeof t?this.mulS(t):this.mulM(t)},t.prototype.mulS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t);return this},t.prototype.mulM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)*t.get(e,r));return this},t.mul=function(t,r){return new e(t).mul(r)},t.prototype.multiply=t.prototype.mul,t.prototype.multiplyS=t.prototype.mulS,t.prototype.multiplyM=t.prototype.mulM,t.multiply=t.mul,t.prototype.div=function(t){return"number"==typeof t?this.divS(t):this.divM(t)},t.prototype.divS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t);return this},t.prototype.divM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)/t.get(e,r));return this},t.div=function(t,r){return new e(t).div(r)},t.prototype.divide=t.prototype.div,t.prototype.divideS=t.prototype.divS,t.prototype.divideM=t.prototype.divM,t.divide=t.div,t.prototype.mod=function(t){return"number"==typeof t?this.modS(t):this.modM(t)},t.prototype.modS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t);return this},t.prototype.modM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)%t.get(e,r));return this},t.mod=function(t,r){return new e(t).mod(r)},t.prototype.modulus=t.prototype.mod,t.prototype.modulusS=t.prototype.modS,t.prototype.modulusM=t.prototype.modM,t.modulus=t.mod,t.prototype.and=function(t){return"number"==typeof t?this.andS(t):this.andM(t)},t.prototype.andS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t);return this},t.prototype.andM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)&t.get(e,r));return this},t.and=function(t,r){return new e(t).and(r)},t.prototype.or=function(t){return"number"==typeof t?this.orS(t):this.orM(t)},t.prototype.orS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t);return this},t.prototype.orM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)|t.get(e,r));return this},t.or=function(t,r){return new e(t).or(r)},t.prototype.xor=function(t){return"number"==typeof t?this.xorS(t):this.xorM(t)},t.prototype.xorS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t);return this},t.prototype.xorM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)^t.get(e,r));return this},t.xor=function(t,r){return new e(t).xor(r)},t.prototype.leftShift=function(t){return"number"==typeof t?this.leftShiftS(t):this.leftShiftM(t)},t.prototype.leftShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t);return this},t.prototype.leftShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)<<t.get(e,r));return this},t.leftShift=function(t,r){return new e(t).leftShift(r)},t.prototype.signPropagatingRightShift=function(t){return"number"==typeof t?this.signPropagatingRightShiftS(t):this.signPropagatingRightShiftM(t)},t.prototype.signPropagatingRightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t);return this},t.prototype.signPropagatingRightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>t.get(e,r));return this},t.signPropagatingRightShift=function(t,r){return new e(t).signPropagatingRightShift(r)},t.prototype.rightShift=function(t){return"number"==typeof t?this.rightShiftS(t):this.rightShiftM(t)},t.prototype.rightShiftS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t);return this},t.prototype.rightShiftM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,this.get(e,r)>>>t.get(e,r));return this},t.rightShift=function(t,r){return new e(t).rightShift(r)},t.prototype.zeroFillRightShift=t.prototype.rightShift,t.prototype.zeroFillRightShiftS=t.prototype.rightShiftS,t.prototype.zeroFillRightShiftM=t.prototype.rightShiftM,t.zeroFillRightShift=t.rightShift,t.prototype.not=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,~this.get(t,e));return this},t.not=function(t){return new e(t).not()},t.prototype.abs=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.abs(this.get(t,e)));return this},t.abs=function(t){return new e(t).abs()},t.prototype.acos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acos(this.get(t,e)));return this},t.acos=function(t){return new e(t).acos()},t.prototype.acosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.acosh(this.get(t,e)));return this},t.acosh=function(t){return new e(t).acosh()},t.prototype.asin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asin(this.get(t,e)));return this},t.asin=function(t){return new e(t).asin()},t.prototype.asinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.asinh(this.get(t,e)));return this},t.asinh=function(t){return new e(t).asinh()},t.prototype.atan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atan(this.get(t,e)));return this},t.atan=function(t){return new e(t).atan()},t.prototype.atanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.atanh(this.get(t,e)));return this},t.atanh=function(t){return new e(t).atanh()},t.prototype.cbrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cbrt(this.get(t,e)));return this},t.cbrt=function(t){return new e(t).cbrt()},t.prototype.ceil=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.ceil(this.get(t,e)));return this},t.ceil=function(t){return new e(t).ceil()},t.prototype.clz32=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.clz32(this.get(t,e)));return this},t.clz32=function(t){return new e(t).clz32()},t.prototype.cos=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cos(this.get(t,e)));return this},t.cos=function(t){return new e(t).cos()},t.prototype.cosh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.cosh(this.get(t,e)));return this},t.cosh=function(t){return new e(t).cosh()},t.prototype.exp=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.exp(this.get(t,e)));return this},t.exp=function(t){return new e(t).exp()},t.prototype.expm1=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.expm1(this.get(t,e)));return this},t.expm1=function(t){return new e(t).expm1()},t.prototype.floor=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.floor(this.get(t,e)));return this},t.floor=function(t){return new e(t).floor()},t.prototype.fround=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.fround(this.get(t,e)));return this},t.fround=function(t){return new e(t).fround()},t.prototype.log=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log(this.get(t,e)));return this},t.log=function(t){return new e(t).log()},t.prototype.log1p=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log1p(this.get(t,e)));return this},t.log1p=function(t){return new e(t).log1p()},t.prototype.log10=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log10(this.get(t,e)));return this},t.log10=function(t){return new e(t).log10()},t.prototype.log2=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.log2(this.get(t,e)));return this},t.log2=function(t){return new e(t).log2()},t.prototype.round=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.round(this.get(t,e)));return this},t.round=function(t){return new e(t).round()},t.prototype.sign=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sign(this.get(t,e)));return this},t.sign=function(t){return new e(t).sign()},t.prototype.sin=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sin(this.get(t,e)));return this},t.sin=function(t){return new e(t).sin()},t.prototype.sinh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sinh(this.get(t,e)));return this},t.sinh=function(t){return new e(t).sinh()},t.prototype.sqrt=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.sqrt(this.get(t,e)));return this},t.sqrt=function(t){return new e(t).sqrt()},t.prototype.tan=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tan(this.get(t,e)));return this},t.tan=function(t){return new e(t).tan()},t.prototype.tanh=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.tanh(this.get(t,e)));return this},t.tanh=function(t){return new e(t).tanh()},t.prototype.trunc=function(){for(let t=0;t<this.rows;t++)for(let e=0;e<this.columns;e++)this.set(t,e,Math.trunc(this.get(t,e)));return this},t.trunc=function(t){return new e(t).trunc()},t.pow=function(t,r){return new e(t).pow(r)},t.prototype.pow=function(t){return"number"==typeof t?this.powS(t):this.powM(t)},t.prototype.powS=function(t){for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t));return this},t.prototype.powM=function(t){if(t=e.checkMatrix(t),this.rows!==t.rows||this.columns!==t.columns)throw new RangeError("Matrices dimensions must be equal");for(let e=0;e<this.rows;e++)for(let r=0;r<this.columns;r++)this.set(e,r,Math.pow(this.get(e,r),t.get(e,r)));return this}}(X,L);class D extends X{constructor(t,e,r){super(),this.matrix=t,this.rows=e,this.columns=r}}class P extends D{constructor(t){super(t,t.columns,t.rows)}set(t,e,r){return this.matrix.set(e,t,r),this}get(t,e){return this.matrix.get(e,t)}}class q extends X{constructor(t){super(),this.data=t,this.rows=t.length,this.columns=t[0].length}set(t,e,r){return this.data[t][e]=r,this}get(t,e){return this.data[t][e]}}class Y{constructor(t){let e,r,o,n,s,i,l,a,u,h=(t=q.checkMatrix(t)).clone(),f=h.rows,c=h.columns,m=new Float64Array(f),g=1;for(e=0;e<f;e++)m[e]=e;for(a=new Float64Array(f),r=0;r<c;r++){for(e=0;e<f;e++)a[e]=h.get(e,r);for(e=0;e<f;e++){for(u=Math.min(e,r),s=0,o=0;o<u;o++)s+=h.get(e,o)*a[o];a[e]-=s,h.set(e,r,a[e])}for(n=r,e=r+1;e<f;e++)Math.abs(a[e])>Math.abs(a[n])&&(n=e);if(n!==r){for(o=0;o<c;o++)i=h.get(n,o),h.set(n,o,h.get(r,o)),h.set(r,o,i);l=m[n],m[n]=m[r],m[r]=l,g=-g}if(r<f&&0!==h.get(r,r))for(e=r+1;e<f;e++)h.set(e,r,h.get(e,r)/h.get(r,r))}this.LU=h,this.pivotVector=m,this.pivotSign=g}isSingular(){let t=this.LU,e=t.columns;for(let r=0;r<e;r++)if(0===t.get(r,r))return!0;return!1}solve(t){t=L.checkMatrix(t);let e=this.LU;if(e.rows!==t.rows)throw new Error("Invalid matrix dimensions");if(this.isSingular())throw new Error("LU matrix is singular");let r,o,n,s=t.columns,i=t.subMatrixRow(this.pivotVector,0,s-1),l=e.columns;for(n=0;n<l;n++)for(r=n+1;r<l;r++)for(o=0;o<s;o++)i.set(r,o,i.get(r,o)-i.get(n,o)*e.get(r,n));for(n=l-1;n>=0;n--){for(o=0;o<s;o++)i.set(n,o,i.get(n,o)/e.get(n,n));for(r=0;r<n;r++)for(o=0;o<s;o++)i.set(r,o,i.get(r,o)-i.get(n,o)*e.get(r,n))}return i}get determinant(){let t=this.LU;if(!t.isSquare())throw new Error("Matrix must be square");let e=this.pivotSign,r=t.columns;for(let o=0;o<r;o++)e*=t.get(o,o);return e}get lowerTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new L(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n>e?o.set(n,e,t.get(n,e)):n===e?o.set(n,e,1):o.set(n,e,0);return o}get upperTriangularMatrix(){let t=this.LU,e=t.rows,r=t.columns,o=new L(e,r);for(let n=0;n<e;n++)for(let e=0;e<r;e++)n<=e?o.set(n,e,t.get(n,e)):o.set(n,e,0);return o}get pivotPermutationVector(){return Array.from(this.pivotVector)}}function U(t,e){let r=0;return Math.abs(t)>Math.abs(e)?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0!==e?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0}class j{constructor(t){let e,r,o,n,s=(t=q.checkMatrix(t)).clone(),i=t.rows,l=t.columns,a=new Float64Array(l);for(o=0;o<l;o++){let t=0;for(e=o;e<i;e++)t=U(t,s.get(e,o));if(0!==t){for(s.get(o,o)<0&&(t=-t),e=o;e<i;e++)s.set(e,o,s.get(e,o)/t);for(s.set(o,o,s.get(o,o)+1),r=o+1;r<l;r++){for(n=0,e=o;e<i;e++)n+=s.get(e,o)*s.get(e,r);for(n=-n/s.get(o,o),e=o;e<i;e++)s.set(e,r,s.get(e,r)+n*s.get(e,o))}}a[o]=-t}this.QR=s,this.Rdiag=a}solve(t){t=L.checkMatrix(t);let e=this.QR,r=e.rows;if(t.rows!==r)throw new Error("Matrix row dimensions must agree");if(!this.isFullRank())throw new Error("Matrix is rank deficient");let o,n,s,i,l=t.columns,a=t.clone(),u=e.columns;for(s=0;s<u;s++)for(n=0;n<l;n++){for(i=0,o=s;o<r;o++)i+=e.get(o,s)*a.get(o,n);for(i=-i/e.get(s,s),o=s;o<r;o++)a.set(o,n,a.get(o,n)+i*e.get(o,s))}for(s=u-1;s>=0;s--){for(n=0;n<l;n++)a.set(s,n,a.get(s,n)/this.Rdiag[s]);for(o=0;o<s;o++)for(n=0;n<l;n++)a.set(o,n,a.get(o,n)-a.get(s,n)*e.get(o,s))}return a.subMatrix(0,u-1,0,l-1)}isFullRank(){let t=this.QR.columns;for(let e=0;e<t;e++)if(0===this.Rdiag[e])return!1;return!0}get upperTriangularMatrix(){let t,e,r=this.QR,o=r.columns,n=new L(o,o);for(t=0;t<o;t++)for(e=0;e<o;e++)t<e?n.set(t,e,r.get(t,e)):t===e?n.set(t,e,this.Rdiag[t]):n.set(t,e,0);return n}get orthogonalMatrix(){let t,e,r,o,n=this.QR,s=n.rows,i=n.columns,l=new L(s,i);for(r=i-1;r>=0;r--){for(t=0;t<s;t++)l.set(t,r,0);for(l.set(r,r,1),e=r;e<i;e++)if(0!==n.get(r,r)){for(o=0,t=r;t<s;t++)o+=n.get(t,r)*l.get(t,e);for(o=-o/n.get(r,r),t=r;t<s;t++)l.set(t,e,l.get(t,e)+o*n.get(t,r))}}return l}}class _{constructor(t,e={}){let r=(t=q.checkMatrix(t)).rows,o=t.columns;const{computeLeftSingularVectors:n=!0,computeRightSingularVectors:s=!0,autoTranspose:i=!1}=e;let l,a=Boolean(n),u=Boolean(s),h=!1;if(r<o)if(i){l=t.transpose(),r=l.rows,o=l.columns,h=!0;let e=a;a=u,u=e}else l=t.clone(),console.warn("Computing SVD on a matrix with more columns than rows. Consider enabling autoTranspose");else l=t.clone();let f=Math.min(r,o),c=Math.min(r+1,o),m=new Float64Array(c),g=new L(r,f),p=new L(o,o),w=new Float64Array(o),d=new Float64Array(r),y=new Float64Array(c);for(let t=0;t<c;t++)y[t]=t;let b=Math.min(r-1,o),x=Math.max(0,Math.min(o-2,r)),v=Math.max(b,x);for(let t=0;t<v;t++){if(t<b){m[t]=0;for(let e=t;e<r;e++)m[t]=U(m[t],l.get(e,t));if(0!==m[t]){l.get(t,t)<0&&(m[t]=-m[t]);for(let e=t;e<r;e++)l.set(e,t,l.get(e,t)/m[t]);l.set(t,t,l.get(t,t)+1)}m[t]=-m[t]}for(let e=t+1;e<o;e++){if(t<b&&0!==m[t]){let o=0;for(let n=t;n<r;n++)o+=l.get(n,t)*l.get(n,e);o=-o/l.get(t,t);for(let n=t;n<r;n++)l.set(n,e,l.get(n,e)+o*l.get(n,t))}w[e]=l.get(t,e)}if(a&&t<b)for(let e=t;e<r;e++)g.set(e,t,l.get(e,t));if(t<x){w[t]=0;for(let e=t+1;e<o;e++)w[t]=U(w[t],w[e]);if(0!==w[t]){w[t+1]<0&&(w[t]=0-w[t]);for(let e=t+1;e<o;e++)w[e]/=w[t];w[t+1]+=1}if(w[t]=-w[t],t+1<r&&0!==w[t]){for(let e=t+1;e<r;e++)d[e]=0;for(let e=t+1;e<r;e++)for(let r=t+1;r<o;r++)d[e]+=w[r]*l.get(e,r);for(let e=t+1;e<o;e++){let o=-w[e]/w[t+1];for(let n=t+1;n<r;n++)l.set(n,e,l.get(n,e)+o*d[n])}}if(u)for(let e=t+1;e<o;e++)p.set(e,t,w[e])}}let M=Math.min(o,r+1);if(b<o&&(m[b]=l.get(b,b)),r<M&&(m[M-1]=0),x+1<M&&(w[x]=l.get(x,M-1)),w[M-1]=0,a){for(let t=b;t<f;t++){for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}for(let t=b-1;t>=0;t--)if(0!==m[t]){for(let e=t+1;e<f;e++){let o=0;for(let n=t;n<r;n++)o+=g.get(n,t)*g.get(n,e);o=-o/g.get(t,t);for(let n=t;n<r;n++)g.set(n,e,g.get(n,e)+o*g.get(n,t))}for(let e=t;e<r;e++)g.set(e,t,-g.get(e,t));g.set(t,t,1+g.get(t,t));for(let e=0;e<t-1;e++)g.set(e,t,0)}else{for(let e=0;e<r;e++)g.set(e,t,0);g.set(t,t,1)}}if(u)for(let t=o-1;t>=0;t--){if(t<x&&0!==w[t])for(let e=t+1;e<o;e++){let r=0;for(let n=t+1;n<o;n++)r+=p.get(n,t)*p.get(n,e);r=-r/p.get(t+1,t);for(let n=t+1;n<o;n++)p.set(n,e,p.get(n,e)+r*p.get(n,t))}for(let e=0;e<o;e++)p.set(e,t,0);p.set(t,t,1)}let E=M-1,S=Number.EPSILON;for(;M>0;){let t,e;for(t=M-2;t>=-1&&-1!==t;t--){const e=Number.MIN_VALUE+S*Math.abs(m[t]+Math.abs(m[t+1]));if(Math.abs(w[t])<=e||Number.isNaN(w[t])){w[t]=0;break}}if(t===M-2)e=4;else{let r;for(r=M-1;r>=t&&r!==t;r--){let e=(r!==M?Math.abs(w[r]):0)+(r!==t+1?Math.abs(w[r-1]):0);if(Math.abs(m[r])<=S*e){m[r]=0;break}}r===t?e=3:r===M-1?e=1:(e=2,t=r)}switch(t++,e){case 1:{let e=w[M-2];w[M-2]=0;for(let r=M-2;r>=t;r--){let n=U(m[r],e),s=m[r]/n,i=e/n;if(m[r]=n,r!==t&&(e=-i*w[r-1],w[r-1]=s*w[r-1]),u)for(let t=0;t<o;t++)n=s*p.get(t,r)+i*p.get(t,M-1),p.set(t,M-1,-i*p.get(t,r)+s*p.get(t,M-1)),p.set(t,r,n)}break}case 2:{let e=w[t-1];w[t-1]=0;for(let o=t;o<M;o++){let n=U(m[o],e),s=m[o]/n,i=e/n;if(m[o]=n,e=-i*w[o],w[o]=s*w[o],a)for(let e=0;e<r;e++)n=s*g.get(e,o)+i*g.get(e,t-1),g.set(e,t-1,-i*g.get(e,o)+s*g.get(e,t-1)),g.set(e,o,n)}break}case 3:{const e=Math.max(Math.abs(m[M-1]),Math.abs(m[M-2]),Math.abs(w[M-2]),Math.abs(m[t]),Math.abs(w[t])),n=m[M-1]/e,s=m[M-2]/e,i=w[M-2]/e,l=m[t]/e,h=w[t]/e,f=((s+n)*(s-n)+i*i)/2,c=n*i*(n*i);let d=0;0===f&&0===c||(d=f<0?0-Math.sqrt(f*f+c):Math.sqrt(f*f+c),d=c/(f+d));let y=(l+n)*(l-n)+d,b=l*h;for(let e=t;e<M-1;e++){let n=U(y,b);0===n&&(n=Number.MIN_VALUE);let s=y/n,i=b/n;if(e!==t&&(w[e-1]=n),y=s*m[e]+i*w[e],w[e]=s*w[e]-i*m[e],b=i*m[e+1],m[e+1]=s*m[e+1],u)for(let t=0;t<o;t++)n=s*p.get(t,e)+i*p.get(t,e+1),p.set(t,e+1,-i*p.get(t,e)+s*p.get(t,e+1)),p.set(t,e,n);if(n=U(y,b),0===n&&(n=Number.MIN_VALUE),s=y/n,i=b/n,m[e]=n,y=s*w[e]+i*m[e+1],m[e+1]=-i*w[e]+s*m[e+1],b=i*w[e+1],w[e+1]=s*w[e+1],a&&e<r-1)for(let t=0;t<r;t++)n=s*g.get(t,e)+i*g.get(t,e+1),g.set(t,e+1,-i*g.get(t,e)+s*g.get(t,e+1)),g.set(t,e,n)}w[M-2]=y;break}case 4:if(m[t]<=0&&(m[t]=m[t]<0?-m[t]:0,u))for(let e=0;e<=E;e++)p.set(e,t,-p.get(e,t));for(;t<E&&!(m[t]>=m[t+1]);){let e=m[t];if(m[t]=m[t+1],m[t+1]=e,u&&t<o-1)for(let r=0;r<o;r++)e=p.get(r,t+1),p.set(r,t+1,p.get(r,t)),p.set(r,t,e);if(a&&t<r-1)for(let o=0;o<r;o++)e=g.get(o,t+1),g.set(o,t+1,g.get(o,t)),g.set(o,t,e);t++}M--}}if(h){let t=p;p=g,g=t}this.m=r,this.n=o,this.s=m,this.U=g,this.V=p}solve(t){let e=t,r=this.threshold,o=this.s.length,n=L.zeros(o,o);for(let t=0;t<o;t++)Math.abs(this.s[t])<=r?n.set(t,t,0):n.set(t,t,1/this.s[t]);let s=this.U,i=this.rightSingularVectors,l=i.mmul(n),a=i.rows,u=s.rows,h=L.zeros(a,u);for(let t=0;t<a;t++)for(let e=0;e<u;e++){let r=0;for(let n=0;n<o;n++)r+=l.get(t,n)*s.get(e,n);h.set(t,e,r)}return h.mmul(e)}solveForDiagonal(t){return this.solve(L.diag(t))}inverse(){let t=this.V,e=this.threshold,r=t.rows,o=t.columns,n=new L(r,this.s.length);for(let s=0;s<r;s++)for(let r=0;r<o;r++)Math.abs(this.s[r])>e&&n.set(s,r,t.get(s,r)/this.s[r]);let s=this.U,i=s.rows,l=s.columns,a=new L(r,i);for(let t=0;t<r;t++)for(let e=0;e<i;e++){let r=0;for(let o=0;o<l;o++)r+=n.get(t,o)*s.get(e,o);a.set(t,e,r)}return a}get condition(){return this.s[0]/this.s[Math.min(this.m,this.n)-1]}get norm2(){return this.s[0]}get rank(){let t=Math.max(this.m,this.n)*this.s[0]*Number.EPSILON,e=0,r=this.s;for(let o=0,n=r.length;o<n;o++)r[o]>t&&e++;return e}get diagonal(){return Array.from(this.s)}get threshold(){return Number.EPSILON/2*Math.max(this.m,this.n)*this.s[0]}get leftSingularVectors(){return this.U}get rightSingularVectors(){return this.V}get diagonalMatrix(){return L.diag(this.s)}}function Q(t,e=!1){return t=q.checkMatrix(t),e?new _(t).inverse():function(t,e,r=!1){return t=q.checkMatrix(t),e=q.checkMatrix(e),r?new _(t).solve(e):t.isSquare()?new Y(t).solve(e):new j(t).solve(e)}(t,L.eye(t.rows))}var $={size:1,value:0};var B=function(t,e){if(e=Object.assign({},$,e),Array.isArray(t))return Array.isArray(t[0])?function(t,e){throw void 0===e.size[0]&&(e.size=[e.size,e.size,e.size,e.size]),new Error("matrix not supported yet, sorry")}(0,e):function(t,e){var r=t.length;"number"==typeof e.size&&(e.size=[e.size,e.size]);var o,n,s=r+e.size[0]+e.size[1];if(e.output){if(e.output.length!==s)throw new RangeError("Wrong output size");o=e.output}else o=new Array(s);if("circular"===e.value)for(n=0;n<s;n++)n<e.size[0]?o[n]=t[(r-e.size[0]%r+n)%r]:n<e.size[0]+r?o[n]=t[n-e.size[0]]:o[n]=t[(n-e.size[0])%r];else if("replicate"===e.value)for(n=0;n<s;n++)n<e.size[0]?o[n]=t[0]:n<e.size[0]+r?o[n]=t[n-e.size[0]]:o[n]=t[r-1];else if("symmetric"===e.value){if(e.size[0]>r||e.size[1]>r)throw new RangeError("expanded value should not be bigger than the data length");for(n=0;n<s;n++)n<e.size[0]?o[n]=t[e.size[0]-1-n]:n<e.size[0]+r?o[n]=t[n-e.size[0]]:o[n]=t[2*r+e.size[0]-n-1]}else for(n=0;n<s;n++)n<e.size[0]?o[n]=e.value:n<e.size[0]+r?o[n]=t[n-e.size[0]]:o[n]=e.value;return o}(t,e);throw new TypeError("data should be an array")};const W={windowSize:5,derivative:1,polynomial:2,pad:"none",padValue:"replicate"};function G(t,e,r){if((r=Object.assign({},W,r)).windowSize%2==0||r.windowSize<5||!Number.isInteger(r.windowSize))throw new RangeError("Invalid window size (should be odd and at least 5 integer number)");if(r.derivative<0||!Number.isInteger(r.derivative))throw new RangeError("Derivative should be a positive integer");if(r.polynomial<1||!Number.isInteger(r.polynomial))throw new RangeError("Polynomial should be a positive integer");let o,n,s=Math.floor(r.windowSize/2);"pre"===r.pad&&(t=B(t,{size:s,value:r.padValue}));let i=new Array(t.length-2*s);if(5!==r.windowSize||2!==r.polynomial||1!==r.derivative&&2!==r.derivative){let t=L.ones(r.windowSize,r.polynomial+1),e=-(r.windowSize-1)/2;for(let r=0;r<t.rows;r++)for(let o=0;o<t.columns;o++)e+1===0&&0===o||t.set(r,o,Math.pow(e+r,o));let s=new P(t);o=Q(s.mmul(t)).mmul(s),o=o.getRow(r.derivative),n=1/function(t){let e=1;for(;t>0;)e*=t--;return e}(r.derivative)}else 1===r.derivative?(o=[-2,-1,0,1,2],n=10):(o=[2,-1,-2,-1,2],n=7);let l=n*Math.pow(e,r.derivative);for(let e=s;e<t.length-s;e++){let r=0;for(let n=0;n<o.length;n++)r+=o[n]*t[n+e-s]/l;i[e-s]=r}return"post"===r.pad&&(i=B(i,{size:s,value:r.padValue})),i}const J="weightVersusTemperature";class Z{constructor(t={}){this.id=t.id||Math.random().toString(36).substring(2,10),this.label=t.label||this.id,this.flavors={}}set(t,e={}){const{flavor:r=J}=e;this.flavors[r.toLowerCase()]=function(t,e={}){const{meta:r={},tmp:o={},xLabel:n="",yLabel:s="",title:i=""}=e;let{x:l,y:a}=t;l&&l.length>1&&l[0]>l[l.length-1]?(l=l.reverse(),a=a.reverse()):(l=l||[],a=a||[]);return{x:(t={x:l,y:a}).x,y:t.y,xLabel:n,yLabel:s,title:i,meta:r,tmp:o}}(t,e)}get(t=J){if(t=t.toLowerCase(),this.flavors[t])return this.flavors[t]}getData(t={}){const{flavor:e,normalization:r}=t;let o=this.get(e);if(o)return function(t,e={}){let{from:r=t.x[0],to:o=t.x[t.x.length-1],numberOfPoints:n,filters:s=[],exclusions:i=[],processing:a=""}=e,{x:u,y:f}=d(t,{from:r,to:o});switch(a){case"firstDerivative":e.processing&&(f=G(f,1,{derivative:1,polynomial:2,windowSize:5}),u=u.slice(2,u.length-2));break;case"secondDerivative":e.processing&&(f=G(f,1,{derivative:2,polynomial:2,windowSize:5}),u=u.slice(2,u.length-2))}for(let t of s){let e=t.options||{};switch(t.name){case"centerMean":{let t=b.mean(f);f=S.subtract(t);break}case"scaleSD":{let t=b.standardDeviation(f);f=S.divide(t);break}case"normalize":f=l(f,{sumValue:e.value?Number(e.value):1,algorithm:"absolute"});break;case"rescale":f=h(f,{min:e.min?Number(t.options.min):0,max:e.max?Number(t.options.max):1});break;case"":case void 0:break;default:throw new Error("Unknown process kind: ".concat(process.kind))}}return n?p({x:u,y:f},{from:r,to:o,numberOfPoints:n,exclusions:i}):d({x:u,y:f},{from:r,to:o,exclusions:i})}(o,r)}getXLabel(t){return this.get(t).xLabel}getYLabel(t){return this.get(t).yLabel}}function K(t){return t.replace(/^[ \t]*(.*?)[ \t]*$/,"$1")}const H=["TIC",".RIC","SCANNUMBER"];function tt(t){let e=t.spectra,r=e.length,o={times:new Array(r),series:{ms:{dimension:2,data:new Array(r)}}},n=[];for(let t=0;t<H.length;t++){let s=rt(H[t]);e[0][s]&&(n.push(s),o.series[s]={dimension:1,data:new Array(r)})}for(let t=0;t<r;t++){let r=e[t];o.times[t]=r.pageValue;for(let e=0;e<n.length;e++)o.series[n[e]].data[t]=parseFloat(r[n[e]]);r.data&&(o.series.ms.data[t]=[r.data.x,r.data.y])}t.chromatogram=o}function et(t){return-1!==H.indexOf(t)}function rt(t){return t.toLowerCase().replace(/[^a-z0-9]/g,"")}function ot(t){let e=[];for(let r=0;r<t.length;r++)e.push(parseFloat(t[r]));return e}function nt(t,e){let r=t.yFactor,o=t.deltaX;t.isXYdata=!0;let n=[];t.data=n;let s,i=t.firstX,l=t.firstY,a=!1,u=0;for(;u<e.length;u++)if(s=e.charCodeAt(u),13===s||10===s)a=!0;else if(a)break;let h=!0,f=!1,c=!1,m=0,g=!1,p=!1,w=0,d=0,y=!1,b=!1,x=!1,v=0;for(;u<=e.length;u++)if(s=u===e.length?13:e.charCodeAt(u),p)13!==s&&10!==s||(h=!0,p=!1);else if(s<=57&&s>=48)b=!0,v>0?w+=(s-48)/Math.pow(10,v++):(w*=10,w+=s-48);else if(44===s||46===s)b=!0,v++;else{if(b){if(h)h=!1,c&&(x=!0);else if(x)x=!1;else{f?(m=y?0-w:w,c=!0,f=!1):g||(d=y?0-w:w);let t=g?w-1:1;for(let e=0;e<t;e++)c?l+=m:l=d,n.push(i),n.push(l*r),i+=o}y=!1,w=0,v=0,b=!1,g=!1}if(s<74&&s>63)b=!0,c=!1,w=s-64;else if(s>96&&s<106)b=!0,c=!1,w=s-96,y=!0;else if(115===s)b=!0,g=!0,w=9;else if(s>82&&s<91)b=!0,g=!0,w=s-82;else if(s>73&&s<83)b=!0,f=!0,w=s-73;else if(s>105&&s<115)b=!0,f=!0,w=s-105,y=!0;else if(36===s&&36===e.charCodeAt(u+1))b=!0,p=!0;else if(37===s)b=!0,f=!0,w=0,y=!1;else if(45===s){let t=e.charCodeAt(u+1);(t>=48&&t<=57||44===t||46===t)&&(b=!0,h||(c=!1),y=!0)}else 13!==s&&10!==s||(h=!0,p=!1)}}function st(t,e,r){let o,n=/\$\$.*/,s=/[,\t ]+/;t.isPeaktable=!0;let i=[];t.data=i;let l=e.split(/,? *,?[;\r\n]+ */);for(let e=1;e<l.length;e++)if(o=l[e].trim().replace(n,"").split(s),o.length%2==0)for(let e=0;e<o.length;e+=2)i.push(parseFloat(o[e])*t.xFactor),i.push(parseFloat(o[e+1])*t.yFactor);else r.logs.push("Format error: ".concat(o))}function it(t,e){let r,o=/(\(+|\)+|<+|>+|\s+)/g;t.isXYAdata=!0;let n=[];t.data=n;let s=e.split(/,? *,?[;\r\n]+ */);for(let t=1;t<s.length;t++)r=s[t].trim().replace(o,"").split(","),n.push(parseFloat(r[0])),n.push(parseFloat(r[1]))}var lt=y((function(t){!function(){function e(t){for(var e=0,n=t.length-1,s=void 0,i=void 0,l=void 0,a=o(e,n);;){if(n<=e)return t[a];if(n==e+1)return t[e]>t[n]&&r(t,e,n),t[a];for(t[s=o(e,n)]>t[n]&&r(t,s,n),t[e]>t[n]&&r(t,e,n),t[s]>t[e]&&r(t,s,e),r(t,s,e+1),i=e+1,l=n;;){do{i++}while(t[e]>t[i]);do{l--}while(t[l]>t[e]);if(l<i)break;r(t,i,l)}r(t,e,l),l<=a&&(e=i),l>=a&&(n=l-1)}}var r=function(t,e,r){var o;return o=[t[r],t[e]],t[e]=o[0],t[r]=o[1],o},o=function(t,e){return~~((t+e)/2)};t.exports?t.exports=e:window.median=e}()}));function at(t){if(!n(t))throw new TypeError("input must be an array");if(0===t.length)throw new TypeError("input must not be empty");return lt(t.slice())}function ut(t,e){let r=function(t){let e=t[0].data[0],r=e,o=t.length,n=t[0].data.length/2,s=new Array(o);for(let i=0;i<o;i++){s[i]=new Array(n);let o=t[i].data;for(let t=0;t<n;t++){let n=o[2*t+1];s[i][t]=n,n<e&&(e=n),n>r&&(r=n)}}const i=t[0].data[0],l=t[0].data[t[0].data.length-2],a=t[0].pageValue,u=t[o-1].pageValue;if(i>l)for(let t of s)t.reverse();return a>u&&s.reverse(),{z:s,minX:Math.min(i,l),maxX:Math.max(i,l),minY:Math.min(a,u),maxY:Math.max(a,u),minZ:e,maxZ:r,noise:at(s[0].map(Math.abs))}}(t.spectra);e.noContour||(t.contourLines=function(t,e){let r,o,n,s,i,l,a,u,h,f,c,m,g,p=t.noise,w=t.z,d=w.length,y=w[0].length,b=t.minX,x=(t.maxX-b)/(y-1),v=t.minY,M=(t.maxY-v)/(d-1),E=t.minZ,S=t.maxZ,A=2*e.nbContourLevels,T=new Array(A);for(let t=0;t<A;t++){let A={};T[t]=A;let R=t%2,N=(S-e.noiseMultiplier*p)*Math.exp((t>>1)-e.nbContourLevels);g=0===R?N+e.noiseMultiplier*p:0-N-e.noiseMultiplier*p;let F=[];if(A.zValue=g,A.lines=F,!(g<=E||g>=S))for(let t=0;t<d-1;t++){let e=w[t],p=w[t+1];for(let w=0;w<y-1;w++)r=e[w],o=e[w+1],n=p[w],s=p[w+1],i=r>g,l=o>g,a=n>g,u=s>g,i!==l&&i!==a&&(h=w+(g-r)/(o-r),f=t,c=w,m=t+(g-r)/(n-r),F.push(h*x+b),F.push(f*M+v),F.push(c*x+b),F.push(m*M+v)),u!==l&&u!==a&&(h=w+1,f=t+1-(g-s)/(o-s),c=w+1-(g-s)/(n-s),m=t+1,F.push(h*x+b),F.push(f*M+v),F.push(c*x+b),F.push(m*M+v)),l!==a&&(h=(w+1-(g-o)/(n-o))*x+b,f=(t+(g-o)/(n-o))*M+v,l!==i&&(c=w+1-(g-o)/(r-o),m=t,F.push(h),F.push(f),F.push(c*x+b),F.push(m*M+v)),a!==i&&(c=w,m=t+1-(g-n)/(r-n),F.push(h),F.push(f),F.push(c*x+b),F.push(m*M+v)),l!==u&&(c=w+1,m=t+(g-o)/(s-o),F.push(h),F.push(f),F.push(c*x+b),F.push(m*M+v)),a!==u&&(c=w+(g-n)/(s-n),m=t+1,F.push(h),F.push(f),F.push(c*x+b),F.push(m*M+v)))}}return{minX:t.minX,maxX:t.maxX,minY:t.minY,maxY:t.maxY,segments:T}}(r,e),delete r.z),t.minMax=r}function ht(t,e,r){t.profiling&&t.profiling.push({action:e,time:Date.now()-r.start})}function ft(t){let e=t.spectra[0].data;t.chromatogram={times:e.x.slice(),series:{intensity:{dimension:1,data:e.y.slice()}}}}function ct(t){if(t.xFactor||(t.xFactor=1),t.yFactor||(t.yFactor=1),t.observeFrequency&&t.xUnit&&"HZ"===t.xUnit.toUpperCase()&&(t.xUnit="PPM",t.xFactor=t.xFactor/t.observeFrequency,t.firstX=t.firstX/t.observeFrequency,t.lastX=t.lastX/t.observeFrequency,t.deltaX=t.deltaX/t.observeFrequency),t.shiftOffsetVal){let e=t.firstX-t.shiftOffsetVal;t.firstX=t.firstX-e,t.lastX=t.lastX-e}}const mt=/[, \t]+/;class gt{}const pt={keepRecordsRegExp:/^$/,canonicDataLabels:!0,dynamicTyping:!1,xy:!0,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};function wt(t,e){(e=Object.assign({},pt,e)).wantXY=!e.withoutXY,e.start=Date.now();let r=[],o={profiling:!!e.profiling&&[],logs:[],entries:[]},n={children:[]},s=n,i=[],l=new gt;if("string"!=typeof t)throw new TypeError("the JCAMP should be a string");ht(o,"Before split to LDRS",e);let a=t.replace(/[\r\n]+##/g,"\n##").split("\n##");ht(o,"Split to LDRS",e),a[0]&&(a[0]=a[0].replace(/^[\r\n ]*##/,""));for(let t of a){let n=t.indexOf("="),a=n>0?t.substring(0,n):t,u=n>0?t.substring(n+1).trim():"",h=a.replace(/[_ -]/g,"").toUpperCase();if("DATATABLE"===h){let t=u.indexOf("\n");if(-1===t&&(t=u.indexOf("\r")),t>0){let e=-1,r=-1,o=u.substring(0,t).split(/[ ,;\t]+/);if(o[0].indexOf("++")>0){let t=o[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),n=o[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");e=s.ntuples.symbol.indexOf(t),r=s.ntuples.symbol.indexOf(n)}-1===e&&(e=0),-1===r&&(r=0),s.ntuples.first&&(s.ntuples.first.length>e&&(l.firstX=s.ntuples.first[e]),s.ntuples.first.length>r&&(l.firstY=s.ntuples.first[r])),s.ntuples.last&&(s.ntuples.last.length>e&&(l.lastX=s.ntuples.last[e]),s.ntuples.last.length>r&&(l.lastY=s.ntuples.last[r])),s.ntuples.vardim&&s.ntuples.vardim.length>e&&(l.nbPoints=s.ntuples.vardim[e]),s.ntuples.factor&&(s.ntuples.factor.length>e&&(l.xFactor=s.ntuples.factor[e]),s.ntuples.factor.length>r&&(l.yFactor=s.ntuples.factor[r])),s.ntuples.units&&(s.ntuples.units.length>e&&(l.xUnit=s.ntuples.units[e]),s.ntuples.units.length>r&&(l.yUnit=s.ntuples.units[r])),l.datatable=o[0],o[1]&&o[1].indexOf("PEAKS")>-1?h="PEAKTABLE":o[1]&&(o[1].indexOf("XYDATA")||o[0].indexOf("++")>0)&&(h="XYDATA",l.deltaX=(l.lastX-l.firstX)/(l.nbPoints-1))}}if("XYDATA"!==h)if("PEAKTABLE"!==h)if("PEAKASSIGNMENTS"!==h){if("TITLE"===h){let t=s;t.children||(t.children=[]),s={spectra:[],ntuples:{},info:{}},t.children.push(s),i.push(t),r.push(s),s.title=u}else if("DATATYPE"===h)s.dataType=u,u.indexOf("nD")>-1&&(s.twoD=!0);else if("NTUPLES"===h)u.indexOf("nD")>-1&&(s.twoD=!0);else if("DATACLASS"===h)s.dataClass=u;else if("XUNITS"===h)l.xUnit=u;else if("YUNITS"===h)l.yUnit=u;else if("FIRSTX"===h)l.firstX=parseFloat(u);else if("LASTX"===h)l.lastX=parseFloat(u);else if("FIRSTY"===h)l.firstY=parseFloat(u);else if("LASTY"===h)l.lastY=parseFloat(u);else if("NPOINTS"===h)l.nbPoints=parseFloat(u);else if("XFACTOR"===h)l.xFactor=parseFloat(u);else if("YFACTOR"===h)l.yFactor=parseFloat(u);else if("MAXX"===h)l.maxX=parseFloat(u);else if("MINX"===h)l.minX=parseFloat(u);else if("MAXY"===h)l.maxY=parseFloat(u);else if("MINY"===h)l.minY=parseFloat(u);else if("DELTAX"===h)l.deltaX=parseFloat(u);else if(".OBSERVEFREQUENCY"===h||"$SFO1"===h)l.observeFrequency||(l.observeFrequency=parseFloat(u));else if(".OBSERVENUCLEUS"===h)l.xType||(s.xType=u.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===h)s.indirectFrequency||(s.indirectFrequency=parseFloat(u));else if("$OFFSET"===h)s.shiftOffsetNum=0,l.shiftOffsetVal||(l.shiftOffsetVal=parseFloat(u));else if("$REFERENCEPOINT"===h);else if("VARNAME"===h)s.ntuples.varname=u.split(mt);else if("SYMBOL"===h)s.ntuples.symbol=u.split(mt);else if("VARTYPE"===h)s.ntuples.vartype=u.split(mt);else if("VARFORM"===h)s.ntuples.varform=u.split(mt);else if("VARDIM"===h)s.ntuples.vardim=ot(u.split(mt));else if("UNITS"===h)s.ntuples.units=u.split(mt);else if("FACTOR"===h)s.ntuples.factor=ot(u.split(mt));else if("FIRST"===h)s.ntuples.first=ot(u.split(mt));else if("LAST"===h)s.ntuples.last=ot(u.split(mt));else if("MIN"===h)s.ntuples.min=ot(u.split(mt));else if("MAX"===h)s.ntuples.max=ot(u.split(mt));else if(".NUCLEUS"===h)s.twoD&&(s.yType=u.split(mt)[0]);else if("PAGE"===h){l.page=u.trim(),l.pageValue=parseFloat(u.replace(/^.*=/,"")),l.pageSymbol=l.page.replace(/[=].*/,"");let t=s.ntuples.symbol.indexOf(l.pageSymbol),e="";s.ntuples.units&&s.ntuples.units[t]&&(e=s.ntuples.units[t]),s.indirectFrequency&&"PPM"!==e&&(l.pageValue/=s.indirectFrequency)}else"RETENTIONTIME"===h?l.pageValue=parseFloat(u):et(h)?l[rt(h)]=u:"SAMPLEDESCRIPTION"===h?l.sampleDescription=u:"END"===h&&(s=i.pop());if(s&&s.info&&h.match(e.keepRecordsRegExp)){let t=e.canonicDataLabels?h:a,r=u.trim();e.dynamicTyping&&!isNaN(r)&&(r=Number(r)),s.info[t]?(Array.isArray(s.info[t])||(s.info[t]=[s.info[t]]),s.info[t].push(r)):s.info[t]=r}}else e.wantXY&&(u.match(/.*(XYA).*/)&&it(l,u),s.spectra.push(l),l=new gt);else e.wantXY&&(ct(l),st(l,u,o),s.spectra.push(l),l=new gt);else e.wantXY&&(ct(l),u.match(/.*\+\+.*/)?(l.deltaX||(l.deltaX=(l.lastX-l.firstX)/(l.nbPoints-1)),nt(l,u)):st(l,u,o),s.spectra.push(l),l=new gt)}return ht(o,"Finished parsing",e),function(t,e,r){for(let o of t){if(Object.keys(o.ntuples).length>0){let t=[],e=Object.keys(o.ntuples);for(let r=0;r<e.length;r++){let n=e[r],s=o.ntuples[n];for(let e=0;e<s.length;e++)t[e]||(t[e]={}),t[e][n]=s[e]}o.ntuples=t}if(o.twoD&&r.wantXY&&(ut(o,r),ht(e,"Finished countour plot calculation",r),r.keepSpectra||delete o.spectra),r.chromatogram&&(r.xy=!0),r.xy&&r.wantXY&&o.spectra&&o.spectra.length>0)for(let t of o.spectra)if(t.data){let e=t.data,r={x:new Array(e.length/2),y:new Array(e.length/2)};for(let t=0;t<e.length;t+=2)r.x[t/2]=e[t],r.y[t/2]=e[t+1];t.data=r}r.chromatogram&&(o.spectra.length>1?tt(o):ft(o),ht(e,"Finished chromatogram calculation",r))}}(r,o,e),ht(o,"Total time",e),o.entries=n.children,o.flatten=r,o}function dt(t){return{x:t[0],y:t[1]}}function yt(t){var e=[],r=[];for(const o of t)e.push(o[0]),r.push(o[1]);return{x:e,y:r}}function bt(t){var e=[],r=[];for(const o of t)e.push(o.x),r.push(o.y);return{x:e,y:r}}function xt(t,e={}){const{inputFormat:r,outputFormat:o="xxyyObject"}=e;if(r===o)return t;let n;switch(r){case"xxyyArray":n=dt(t);break;case"xyxyArray":n=yt(t);break;case"xxyyObject":n=t;break;case"xyxyObject":n=bt(t);break;default:n=function(t){if(Array.isArray(t))return 0===t.length?{x:[],y:[]}:Array.isArray(t[0])?2===t.length?dt(t):yt(t):bt(t);if(Array.isArray(t.x)&&Array.isArray(t.x))return t;throw new TypeError("unknown data format")}(t)}switch(o){case"xxyyArray":return function({x:t,y:e}){return[t,e]}(n);case"xyxyArray":return function({x:t,y:e}){for(var r=[],o=0;o<t.length;o++)r.push([t[o],e[o]]);return r}(n);case"xxyyObject":return n;case"xyxyObject":return function({x:t,y:e}){for(var r=[],o=0;o<t.length;o++)r.push({x:t[o],y:e[o]});return r}(n);default:throw new TypeError("unknown output format ".concat(o))}}function vt(t,e={}){return function(t,e={}){const{title:r="",owner:o="",origin:n="",type:s="",xUnit:i="",yUnit:l="",info:a={}}=e;let u=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,f=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,m=[];for(let e=0;e<t.x.length;e++){let r=t.x[e],o=t.y[e];u>r&&(u=r),h<r&&(h=r),f>o&&(f=o),c<o&&(c=o),m.push("".concat(r," ").concat(o))}let g="##TITLE=".concat(r,"\n##JCAMP-DX=4.24\n##DATA TYPE=").concat(s,"\n##ORIGIN=").concat(n,"\n##OWNER=").concat(o,"\n##XUNITS=").concat(i,"\n##YUNITS=").concat(l,"\n##FIRSTX=").concat(u,"\n##LASTX=").concat(h,"\n##FIRSTY=").concat(f,"\n##LASTY=").concat(c,"\n");for(const t of Object.keys(a))g+="##$".concat(t,"=").concat(a[t],"\n");return"".concat(g,"##NPOINTS=").concat(m.length,"\n##PEAK TABLE=(XY..XY)\n").concat(m.join("\n"),"\n##END")}(xt(t,{outputFormat:"xxyyObject"}),e)}function Mt(t){let e={xUnit:t.xLabel,yUnit:t.yLabel,title:t.title,type:"TGA",info:t.meta};return vt({x:t.x,y:t.y},e)}function Et(t,e,r={}){const{color:o="darkgrey"}=r;t.style=[{name:"unselected",style:{line:{color:o,width:1,dash:1}}},{name:"selected",style:{line:{color:o,width:3,dash:1}}}],t.name=e.label||e.id}t.SpectraManager=class{constructor(){this.spectra=[]}addSpectrum(t){let e=this.getSpectrumIndex(t.id);void 0===e?this.spectra.push(t):this.spectra[e]=t}getSpectra(t={}){const{ids:e}=t;let r=[];for(const t of this.spectra)e&&!e.includes(t.id)||r.push(t);return r}removeSpectrum(t){let e=this.getSpectrumIndex(t);if(void 0!==e)return this.spectra.splice(e,1)}getSpectrumIndex(t){if(t)for(let e=0;e<this.spectra.length;e++){if(this.spectra[e].id===t)return e}}contains(t){return!isNaN(this.getSpectrumIndex(t))}},t.Spectrum=Z,t.fromJcamp=function(t,e={}){let r=new Z(e);return function(t,e){let r=wt(e,{keepRecordsRegExp:/.*/,canonicDataLabels:!1,dynamicTyping:!0});for(let e of r.flatten){let r=e.spectra[0],o=r.xUnit,n=r.yUnit,s="";o.match(/\[.*C\]/)&&(s="weightVersusTemperature"),o.match(/\[.*s\]/)&&(s="weightVersusTime"),s&&t.set(r.data,{flavor:s,xLabel:o,yLabel:n,title:r.title})}}(r,t),r},t.fromPerkinElmer=function(t){let e=new Z,r=function(t){let e=t.split(/[\r\n]+/),r={meta:{},data:{time:[],weight:[],temperature:[]}},o="",n=!1;for(let t of e){if(n)t.startsWith("1) TGA")?n=!1:(r.meta["Method Steps"]||(r.meta["Method Steps"]=""),r.meta["Method Steps"]+="".concat(t.replace(/\t/g,"  "),"\n"));else if(t.match(/^[a-zA-Z -]+$/))o=K(t);else if(t.match(/.*:.*/)){let e=t.indexOf(":"),n=t.substring(0,e),s=K(t.substring(e+1));r.meta[(o?"".concat(o,"_"):"")+n]=s}else if(t.match(/^[0-9\t .]+$/)){let e=t.replace(/^\t/,"").split("\t");r.data.time.push(Number(e[0])),r.data.weight.push(Number(e[1])),r.data.temperature.push(Number(e[4]))}t.startsWith("Method Steps:")&&(n=!0)}return r}(t);return e.set({x:r.data.temperature,y:r.data.weight},{xLabel:"Temperature [C]",yLabel:"Weight [mg]",title:r.meta["Sample ID"],meta:r.meta,flavor:"weightVersusTemperature"}),e.set(r.data.time,r.data.weight,{xLabel:"Time [s]",yLabel:"Weight [mg]",title:r.meta["Sample ID"],meta:r.meta,flavor:"weightVersusTime"}),e},t.getJSGraph=function(t,e={}){const{ids:r,colors:o,flavor:n,normalization:s}=e;let i=t.getSpectra({ids:r}),l=[],a="",u="";for(let t=0;t<i.length;t++){const e=i[t];let r={},h=e.getData({flavor:n,normalization:s});h&&(a||(a=e.getXLabel(n)),u||(u=e.getYLabel(n)),Et(r,e,{color:o[t]}),r.data=h,l.push(r))}return{axes:{x:{label:a,unit:"",unitWrapperBefore:"",unitWrapperAfter:"",flipped:!1,display:!0},y:{label:u,unit:"",unitWrapperBefore:"",unitWrapperAfter:"",flipped:!1,display:!0}},series:l}},t.toJcamp=function(t){let e=[],r=t.get("weightVersusTemperature");r&&e.push(Mt(r));let o=t.get("weightVersusTime");return o&&e.push(Mt(o)),e.join("\n")},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=tga-spectrum.min.js.map
