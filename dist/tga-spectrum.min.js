!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).TGASpectrum={})}(this,(function(e){"use strict";const t=Object.prototype.toString;var r=function(e){return t.call(e).endsWith("Array]")};function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==n(e)||r(e)||(t=e,e=[]),!r(e))throw new TypeError("input must be an array");var o=t,a=o.from,i=void 0===a?0:a,s=o.to,l=void 0===s?10:s,u=o.size,f=void 0===u?e.length:u,c=o.step;if(f&&c)throw new Error("step is defined by the array size");if(f||(f=c?Math.floor((l-i)/c)+1:l-i+1),!c&&f&&(c=(l-i)/(f-1)),Array.isArray(e)){e.length=0;for(var p=0;p<f;p++)e.push(i),i+=c}else{if(e.length!==f)throw new Error("sequentialFill typed array must have the correct length");for(var h=0;h<f;h++)e[h]=i,i+=c}return e}function a(e=[],t={}){if(0===e.length)return[];let{from:r=Number.NEGATIVE_INFINITY,to:n=Number.POSITIVE_INFINITY}=t;if(r>n&&([r,n]=[n,r]),(e=(e=JSON.parse(JSON.stringify(e)).map(e=>e.from>e.to?{from:e.to,to:e.from}:e)).sort((e,t)=>e.from!==t.from?e.from-t.from:e.to-t.to)).forEach(e=>{r>e.from&&(e.from=r),n<e.to&&(e.to=n)}),0===(e=e.filter(e=>e.from<=e.to)).length)return[];let o=e[0],a=[o];for(let t=1;t<e.length;t++){let r=e[t];r.from<=o.to?o.to=r.to:(o=r,a.push(o))}return a}function i(e,t,r,n){return.5*r*t*t+n*t-(.5*r*e*e+n*e)}function s(e={},t={}){let{x:r,y:n}=e,o=r.length,i=!1;r.length>1&&r[0]>r[1]&&(r=r.slice().reverse(),n=n.slice().reverse(),i=!0);let{from:s=r[0],to:u=r[o-1],variant:f="smooth",numberOfPoints:c=100,exclusions:p=[],zones:h=[]}=t;if(o!==n.length)throw new RangeError("the x and y vector doesn't have the same size.");if("number"!=typeof s||isNaN(s))throw new RangeError("'from' option must be a number");if("number"!=typeof u||isNaN(u))throw new RangeError("'to' option must be a number");if("number"!=typeof c||isNaN(c))throw new RangeError("'numberOfPoints' option must be a number");if(c<2)throw new RangeError("'numberOfPoints' option must be greater than 1");0===h.length&&(h=function(e=[],t={}){let{from:r=Number.NEGATIVE_INFINITY,to:n=Number.POSITIVE_INFINITY}=t;if(r>n&&([r,n]=[n,r]),0===(e=a(e,{from:r,to:n})).length)return[{from:r,to:n}];let o=[];for(let t=0;t<e.length;t++){let a=e[t],i=e[t+1];0===t&&a.from>r&&o.push({from:r,to:a.from}),t===e.length-1?a.to<n&&o.push({from:a.to,to:n}):o.push({from:a.to,to:i.from})}return o}(p,{from:s,to:u})),h=function(e,t,r={}){if(0===e.length)return e;let n=(e=a(e,r)).reduce((e,t)=>e+(t.to-t.from),0)/t,o=0;for(let r=0;r<e.length-1;r++){let a=e[r];a.numberOfPoints=Math.min(Math.round((a.to-a.from)/n),t-o),o+=a.numberOfPoints}return e[e.length-1].numberOfPoints=t-o,e}(h,c,{from:s,to:u});let m=[],d=[];for(let e of h){let t=l(r,n,e.from,e.to,e.numberOfPoints,f);m=m.concat(t.x),d=d.concat(t.y)}return i?s<u?{x:m.reverse(),y:d.reverse()}:{x:m,y:d}:s<u?{x:m,y:d}:{x:m.reverse(),y:d.reverse()}}function l(e,t,r,n,a,s){if(a<1)throw new RangeError("the number of points must be at least 1");let l="slot"===s?function(e,t,r,n,o){let a=e.length,i=(n-r)/(o-1),s=i/2,l=e[e.length-1]-e[e.length-2],u=r-s,f=new Array(o),c=u,p=u+i,h=-Number.MAX_VALUE,m=0,d=e[0],g=t[0],y=0,v=!0,x=0,b=0,w=1,A=0;e:for(;;){if(h>=d)throw new Error("x must be an increasing serie");for(;h-p>0;){if(v&&(b++,v=!1),f[A]=b<=0?0:x/b,A++,A===o)break e;c=p,p+=i,x=0,b=0}h>c&&(x+=m,b++),(h===-Number.MAX_VALUE||y>1)&&b--,h=d,m=g,w<a?(d=e[w],g=t[w],w++):(d+=l,g=0,y++)}return f}(e,t,r,n,a):function(e,t,r,n,o){let a=e.length,s=(n-r)/(o-1),l=s/2,u=new Array(o),f=e[1]-e[0],c=e[a-1]-e[a-2],p=r-l,h=r+l,m=Number.MIN_VALUE,d=0,g=e[0]-f,y=0,v=0,x=0,b=0,w=0,A=0,T=0,E=0,S=0;e:for(;;){for(m<=p&&p<=g&&(S=i(0,p-m,x,d),w=v+S);g-h>=0;){if(S=i(0,h-m,x,d),A=v+S,u[E++]=(A-w)/s,E===o)break e;p=h,h+=s,w=A}v+=i(m,g,x,b),m=g,d=y,T<a?(g=e[T],y=t[T],T++):T===a&&(g+=c,y=0),x=(y-d)/(g-m),b=-x*m+d}return u}(e,t,r,n,a);return{x:o({from:r,to:n,size:a}),y:l}}function u(e,t){return e(t={exports:{}},t.exports),t.exports}var f=u((function(e,t){function r(e,t){return e-t}t.sum=function(e){for(var t=0,r=0;r<e.length;r++)t+=e[r];return t},t.max=function(e){for(var t=e[0],r=e.length,n=1;n<r;n++)e[n]>t&&(t=e[n]);return t},t.min=function(e){for(var t=e[0],r=e.length,n=1;n<r;n++)e[n]<t&&(t=e[n]);return t},t.minMax=function(e){for(var t=e[0],r=e[0],n=e.length,o=1;o<n;o++)e[o]<t&&(t=e[o]),e[o]>r&&(r=e[o]);return{min:t,max:r}},t.arithmeticMean=function(e){for(var t=0,r=e.length,n=0;n<r;n++)t+=e[n];return t/r},t.mean=t.arithmeticMean,t.geometricMean=function(e){for(var t=1,r=e.length,n=0;n<r;n++)t*=e[n];return Math.pow(t,1/r)},t.logMean=function(e){for(var t=0,r=e.length,n=0;n<r;n++)t+=Math.log(e[n]);return t/r},t.grandMean=function(e,t){for(var r=0,n=0,o=e.length,a=0;a<o;a++)r+=t[a]*e[a],n+=t[a];return r/n},t.truncatedMean=function(e,t,n){void 0===n&&(n=!1),n||(e=[].concat(e).sort(r));for(var o=e.length,a=Math.floor(o*t),i=0,s=a;s<o-a;s++)i+=e[s];return i/(o-2*a)},t.harmonicMean=function(e){for(var t=0,r=e.length,n=0;n<r;n++){if(0===e[n])throw new RangeError("value at index "+n+"is zero");t+=1/e[n]}return r/t},t.contraHarmonicMean=function(e){for(var t=0,r=0,n=e.length,o=0;o<n;o++)t+=e[o]*e[o],r+=e[o];if(r<0)throw new RangeError("sum of values is negative");return t/r},t.median=function(e,t){void 0===t&&(t=!1),t||(e=[].concat(e).sort(r));var n=e.length,o=Math.floor(n/2);return n%2==0?.5*(e[o-1]+e[o]):e[o]},t.variance=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,a=e.length,i=0;i<a;i++){var s=e[i]-n;o+=s*s}return r?o/(a-1):o/a},t.standardDeviation=function(e,r){return Math.sqrt(t.variance(e,r))},t.standardError=function(e){return t.standardDeviation(e)/Math.sqrt(e.length)},t.robustMeanAndStdev=function(e){var t=0,n=e.length,o=0;for(o=0;o<n;o++)t+=e[o];t/=n;var a=new Array(n);for(o=0;o<n;o++)a[o]=Math.abs(e[o]-t);return a.sort(r),{mean:t,stdev:n%2==1?a[(n-1)/2]/.6745:.5*(a[n/2]+a[n/2-1])/.6745}},t.quartiles=function(e,n){void 0===n&&(n=!1),n||(e=[].concat(e).sort(r));var o=e.length/4;return{q1:e[Math.ceil(o)-1],q2:t.median(e,!0),q3:e[Math.ceil(3*o)-1]}},t.pooledStandardDeviation=function(e,r){return Math.sqrt(t.pooledVariance(e,r))},t.pooledVariance=function(e,r){void 0===r&&(r=!0);for(var n=0,o=0,a=e.length,i=0;i<a;i++){var s=e[i],l=t.variance(s);n+=(s.length-1)*l,o+=r?s.length-1:s.length}return n/o},t.mode=function(e){var t,r=e.length,n=new Array(r);for(t=0;t<r;t++)n[t]=0;var o=new Array(r),a=0;for(t=0;t<r;t++){var i=o.indexOf(e[t]);i>=0?n[i]++:(o[a]=e[t],n[a]=1,a++)}var s=0,l=0;for(t=0;t<a;t++)n[t]>s&&(s=n[t],l=t);return o[l]},t.covariance=function(e,r,n){void 0===n&&(n=!0);var o=t.mean(e),a=t.mean(r);if(e.length!==r.length)throw"Vectors do not have the same dimensions";for(var i=0,s=e.length,l=0;l<s;l++){i+=(e[l]-o)*(r[l]-a)}return n?i/(s-1):i/s},t.skewness=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=0,a=0,i=e.length,s=0;s<i;s++){var l=e[s]-n;o+=l*l,a+=l*l*l}var u=o/i,f=a/i/Math.pow(u,1.5);return r?Math.sqrt(i*(i-1))/(i-2)*f:f},t.kurtosis=function(e,r){void 0===r&&(r=!0);for(var n=t.mean(e),o=e.length,a=0,i=0,s=0;s<o;s++){var l=e[s]-n;a+=l*l,i+=l*l*l*l}var u=a/o;if(r){var f=a/(o-1);return o*(o+1)/((o-1)*(o-2)*(o-3))*(i/(f*f))-3*((o-1)*(o-1)/((o-2)*(o-3)))}return i/o/(u*u)-3},t.entropy=function(e,t){void 0===t&&(t=0);for(var r=0,n=e.length,o=0;o<n;o++)r+=e[o]*Math.log(e[o]+t);return-r},t.weightedMean=function(e,t){for(var r=0,n=e.length,o=0;o<n;o++)r+=e[o]*t[o];return r},t.weightedStandardDeviation=function(e,r){return Math.sqrt(t.weightedVariance(e,r))},t.weightedVariance=function(e,r){for(var n=t.weightedMean(e,r),o=0,a=e.length,i=0,s=0,l=0;l<a;l++){var u=e[l]-n,f=r[l];o+=f*(u*u),s+=f,i+=f*f}return o*(s/(s*s-i))},t.center=function(e,r){void 0===r&&(r=!1);var n=e;r||(n=[].concat(e));for(var o=t.mean(n),a=n.length,i=0;i<a;i++)n[i]-=o},t.standardize=function(e,r,n){void 0===r&&(r=t.standardDeviation(e)),void 0===n&&(n=!1);for(var o=e.length,a=n?e:new Array(o),i=0;i<o;i++)a[i]=e[i]/r;return a},t.cumulativeSum=function(e){var t=e.length,r=new Array(t);r[0]=e[0];for(var n=1;n<t;n++)r[n]=r[n-1]+e[n];return r}}));f.sum,f.max,f.min,f.minMax,f.arithmeticMean,f.mean,f.geometricMean,f.logMean,f.grandMean,f.truncatedMean,f.harmonicMean,f.contraHarmonicMean,f.median,f.variance,f.standardDeviation,f.standardError,f.robustMeanAndStdev,f.quartiles,f.pooledStandardDeviation,f.pooledVariance,f.mode,f.covariance,f.skewness,f.kurtosis,f.entropy,f.weightedMean,f.weightedStandardDeviation,f.weightedVariance,f.center,f.standardize,f.cumulativeSum;const c=Object.prototype.toString;function p(e){return c.call(e).endsWith("Array]")}const h=Object.prototype.toString;var m=function(e){return h.call(e).endsWith("Array]")};function d(e){if(!m(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");for(var t=e[0],r=1;r<e.length;r++)e[r]>t&&(t=e[r]);return t}function g(e){if(!r(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function y(e){var t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.algorithm,o=void 0===n?"absolute":n,a=r.maxValue,i=void 0===a?1:a;if(!p(e))throw new Error("input must be an array");if(void 0!==r.output){if(!p(r.output))throw new TypeError("output option must be an array if specified");t=r.output}else t=new Array(e.length);if(0===e.length)throw new Error("input must not be empty");switch(o.toLowerCase()){case"absolute":var s=v(e);if(0===s)return e.slice(0);for(var l=0;l<e.length;l++)t[l]=e[l]/s;return t;case"max":var u=d(e);if(0===u)return e.slice(0);for(var f=i/u,c=0;c<e.length;c++)t[c]=e[c]*f;return t;case"sum":var h=g(e);if(0===h)return e.slice(0);for(var m=0;m<e.length;m++)t[m]=e[m]/h;return t;default:throw new Error("norm: unknown algorithm: ".concat(o))}}function v(e){for(var t=0,r=0;r<e.length;r++)t+=Math.abs(e[r]);return t}function x(e){if(!m(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");for(var t=e[0],r=1;r<e.length;r++)e[r]<t&&(t=e[r]);return t}function b(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!r(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");if(void 0!==n.output){if(!r(n.output))throw new TypeError("output option must be an array if specified");t=n.output}else t=new Array(e.length);var o=x(e),a=d(e);if(o===a)throw new RangeError("minimum and maximum input values are equal. Cannot rescale a constant array");var i=n.min,s=void 0===i?n.autoMinMax?o:0:i,l=n.max,u=void 0===l?n.autoMinMax?a:1:l;if(s>=u)throw new RangeError("min option must be smaller than max option");for(var f=(u-s)/(a-o),c=0;c<e.length;c++)t[c]=(e[c]-o)*f+s;return t}function w(e,t={}){const{x:r,y:n}=e,{from:o=r[0],to:a=r[r.length-1],exclusions:i=[]}=t;let s=function(e,t,r=[]){e>t&&([e,t]=[t,e]),r=r.filter(e=>void 0!==e.from&&void 0!==e.to),(r=JSON.parse(JSON.stringify(r))).forEach(e=>{e.from>e.to&&([e.to,e.from]=[e.from,e.to])}),r.sort((e,t)=>e.from-t.from),r.forEach(r=>{r.from<e&&(r.from=e),r.to>t&&(r.to=t)});for(let e=0;e<r.length-1;e++)r[e].to>r[e+1].from&&(r[e].to=r[e+1].from);if(!(r=r.filter(e=>e.from<e.to))||0===r.length)return[{from:e,to:t}];let n=[],o=e;for(let e of r)o<e.from&&n.push({from:o,to:e.from}),o=e.to;return o<t&&n.push({from:o,to:t}),n}(o,a,i),l=0,u=[],f=[],c=0;for(;c<r.length;){if(r[c]<=s[l].to&&r[c]>=s[l].from)u.push(r[c]),f.push(n[c]);else if(r[c]>s[l].to&&(l++,!s[l]))break;c++}return{x:u,y:f}}const A="weightVersusTemperature";class T{constructor(e={}){this.id=e.id||Math.random().toString(36).substring(2,10),this.flavors={}}set(e,t={}){const{flavor:r=A}=t;this.flavors[r.toLowerCase()]=function(e,t={}){const{meta:r={},tmp:n={},xLabel:o="",yLabel:a="",title:i=""}=t;{let{x:t,y:r}=e;t&&t.length>1&&t[0]>t[t.length-1]?(t=t.reverse(),r=r.reverse()):(t=t||[],r=r||[]),e={x:t,y:r}}return{x:e.x,y:e.y,xLabel:o,yLabel:a,title:i,meta:r,tmp:n}}(e,t)}get(e=A){if(e=e.toLowerCase(),this.flavors[e])return this.flavors[e]}getData(e={}){const{flavor:t,normalization:r}=e;let n=this.get(t);if(n)return function(e,t={}){let{from:r=e.x[0],to:n=e.x[e.x.length-1],numberOfPoints:o,filters:a=[],exclusions:i=[]}=t,l=e.y.slice(0);console.log({filters:a});for(let t of a)switch(t.name){case"centerMean":{let t=f.mean(e.y),r=e=>e-t;l=l.map(r);break}case"scaleSD":{let t=f.standardDeviation(e.y),r=e=>e/t;l=l.map(r);break}case"normalize":l=y(l);break;case"rescale":l=b(l);break;case"":case void 0:break;default:throw new Error("Unknown process kind: ".concat(process.kind))}return console.log({from:r,to:n,spectrum:e,numberOfPoints:o}),o?s({x:e.x,y:l},{from:r,to:n,numberOfPoints:o,exclusions:i}):w({x:e.x,y:l},{from:r,to:n,exclusions:i})}(n,r)}getXLabel(e){return this.get(e).xAxis}getYLabel(e){return this.get(e).yAxis}}function E(e){return e.replace(/^[ \t]*(.*?)[ \t]*$/,"$1")}const S=["TIC",".RIC","SCANNUMBER"];function M(e){let t=e.spectra,r=t.length,n={times:new Array(r),series:{ms:{dimension:2,data:new Array(r)}}},o=[];for(let e=0;e<S.length;e++){let a=F(S[e]);t[0][a]&&(o.push(a),n.series[a]={dimension:1,data:new Array(r)})}for(let e=0;e<r;e++){let r=t[e];n.times[e]=r.pageValue;for(let t=0;t<o.length;t++)n.series[o[t]].data[e]=parseFloat(r[o[t]]);r.data&&(n.series.ms.data[e]=[r.data.x,r.data.y])}e.chromatogram=n}function N(e){return-1!==S.indexOf(e)}function F(e){return e.toLowerCase().replace(/[^a-z0-9]/g,"")}function I(e){let t=[];for(let r=0;r<e.length;r++)t.push(parseFloat(e[r]));return t}function O(e,t){let r=e.yFactor,n=e.deltaX;e.isXYdata=!0;let o=[];e.data=o;let a,i=e.firstX,s=e.firstY,l=!1,u=0;for(;u<t.length;u++)if(a=t.charCodeAt(u),13===a||10===a)l=!0;else if(l)break;let f=!0,c=!1,p=!1,h=0,m=!1,d=!1,g=0,y=0,v=!1,x=!1,b=!1,w=0;for(;u<=t.length;u++)if(a=u===t.length?13:t.charCodeAt(u),d)13!==a&&10!==a||(f=!0,d=!1);else if(a<=57&&a>=48)x=!0,w>0?g+=(a-48)/Math.pow(10,w++):(g*=10,g+=a-48);else if(44===a||46===a)x=!0,w++;else{if(x){if(f)f=!1,p&&(b=!0);else if(b)b=!1;else{c?(h=v?0-g:g,p=!0,c=!1):m||(y=v?0-g:g);let e=m?g-1:1;for(let t=0;t<e;t++)p?s+=h:s=y,o.push(i),o.push(s*r),i+=n}v=!1,g=0,w=0,x=!1,m=!1}if(a<74&&a>63)x=!0,p=!1,g=a-64;else if(a>96&&a<106)x=!0,p=!1,g=a-96,v=!0;else if(115===a)x=!0,m=!0,g=9;else if(a>82&&a<91)x=!0,m=!0,g=a-82;else if(a>73&&a<83)x=!0,c=!0,g=a-73;else if(a>105&&a<115)x=!0,c=!0,g=a-105,v=!0;else if(36===a&&36===t.charCodeAt(u+1))x=!0,d=!0;else if(37===a)x=!0,c=!0,g=0,v=!1;else if(45===a){let e=t.charCodeAt(u+1);(e>=48&&e<=57||44===e||46===e)&&(x=!0,f||(p=!1),v=!0)}else 13!==a&&10!==a||(f=!0,d=!1)}}function X(e,t,r){let n,o=/\$\$.*/,a=/[,\t ]+/;e.isPeaktable=!0;let i=[];e.data=i;let s=t.split(/,? *,?[;\r\n]+ */);for(let t=1;t<s.length;t++)if(n=s[t].trim().replace(o,"").split(a),n.length%2==0)for(let t=0;t<n.length;t+=2)i.push(parseFloat(n[t])*e.xFactor),i.push(parseFloat(n[t+1])*e.yFactor);else r.logs.push("Format error: ".concat(n))}function Y(e,t){let r,n=/(\(+|\)+|<+|>+|\s+)/g;e.isXYAdata=!0;let o=[];e.data=o;let a=t.split(/,? *,?[;\r\n]+ */);for(let e=1;e<a.length;e++)r=a[e].trim().replace(n,"").split(","),o.push(parseFloat(r[0])),o.push(parseFloat(r[1]))}var L=u((function(e){!function(){function t(e){for(var t=0,o=e.length-1,a=void 0,i=void 0,s=void 0,l=n(t,o);;){if(o<=t)return e[l];if(o==t+1)return e[t]>e[o]&&r(e,t,o),e[l];for(e[a=n(t,o)]>e[o]&&r(e,a,o),e[t]>e[o]&&r(e,t,o),e[a]>e[t]&&r(e,a,t),r(e,a,t+1),i=t+1,s=o;;){do{i++}while(e[t]>e[i]);do{s--}while(e[s]>e[t]);if(s<i)break;r(e,i,s)}r(e,t,s),s<=l&&(t=i),s>=l&&(o=s-1)}}var r=function(e,t,r){var n;return n=[e[r],e[t]],e[t]=n[0],e[r]=n[1],n},n=function(e,t){return~~((e+t)/2)};e.exports?e.exports=t:window.median=t}()}));function V(e){if(!r(e))throw new TypeError("input must be an array");if(0===e.length)throw new TypeError("input must not be empty");return L(e.slice())}function P(e,t){let r=function(e){let t=e[0].data[0],r=t,n=e.length,o=e[0].data.length/2,a=new Array(n);for(let i=0;i<n;i++){a[i]=new Array(o);let n=e[i].data;for(let e=0;e<o;e++){let o=n[2*e+1];a[i][e]=o,o<t&&(t=o),o>r&&(r=o)}}const i=e[0].data[0],s=e[0].data[e[0].data.length-2],l=e[0].pageValue,u=e[n-1].pageValue;if(i>s)for(let e of a)e.reverse();return l>u&&a.reverse(),{z:a,minX:Math.min(i,s),maxX:Math.max(i,s),minY:Math.min(l,u),maxY:Math.max(l,u),minZ:t,maxZ:r,noise:V(a[0].map(Math.abs))}}(e.spectra);t.noContour||(e.contourLines=function(e,t){let r,n,o,a,i,s,l,u,f,c,p,h,m,d=e.noise,g=e.z,y=g.length,v=g[0].length,x=e.minX,b=(e.maxX-x)/(v-1),w=e.minY,A=(e.maxY-w)/(y-1),T=e.minZ,E=e.maxZ,S=2*t.nbContourLevels,M=new Array(S);for(let e=0;e<S;e++){let S={};M[e]=S;let N=e%2,F=(E-t.noiseMultiplier*d)*Math.exp((e>>1)-t.nbContourLevels);m=0===N?F+t.noiseMultiplier*d:0-F-t.noiseMultiplier*d;let I=[];if(S.zValue=m,S.lines=I,!(m<=T||m>=E))for(let e=0;e<y-1;e++){let t=g[e],d=g[e+1];for(let g=0;g<v-1;g++)r=t[g],n=t[g+1],o=d[g],a=d[g+1],i=r>m,s=n>m,l=o>m,u=a>m,i!==s&&i!==l&&(f=g+(m-r)/(n-r),c=e,p=g,h=e+(m-r)/(o-r),I.push(f*b+x),I.push(c*A+w),I.push(p*b+x),I.push(h*A+w)),u!==s&&u!==l&&(f=g+1,c=e+1-(m-a)/(n-a),p=g+1-(m-a)/(o-a),h=e+1,I.push(f*b+x),I.push(c*A+w),I.push(p*b+x),I.push(h*A+w)),s!==l&&(f=(g+1-(m-n)/(o-n))*b+x,c=(e+(m-n)/(o-n))*A+w,s!==i&&(p=g+1-(m-n)/(r-n),h=e,I.push(f),I.push(c),I.push(p*b+x),I.push(h*A+w)),l!==i&&(p=g,h=e+1-(m-o)/(r-o),I.push(f),I.push(c),I.push(p*b+x),I.push(h*A+w)),s!==u&&(p=g+1,h=e+(m-n)/(a-n),I.push(f),I.push(c),I.push(p*b+x),I.push(h*A+w)),l!==u&&(p=g+(m-o)/(a-o),h=e+1,I.push(f),I.push(c),I.push(p*b+x),I.push(h*A+w)))}}return{minX:e.minX,maxX:e.maxX,minY:e.minY,maxY:e.maxY,segments:M}}(r,t),delete r.z),e.minMax=r}function R(e,t,r){e.profiling&&e.profiling.push({action:t,time:Date.now()-r.start})}function D(e){let t=e.spectra[0].data;e.chromatogram={times:t.x.slice(),series:{intensity:{dimension:1,data:t.y.slice()}}}}function k(e){if(e.xFactor||(e.xFactor=1),e.yFactor||(e.yFactor=1),e.observeFrequency&&e.xUnit&&"HZ"===e.xUnit.toUpperCase()&&(e.xUnit="PPM",e.xFactor=e.xFactor/e.observeFrequency,e.firstX=e.firstX/e.observeFrequency,e.lastX=e.lastX/e.observeFrequency,e.deltaX=e.deltaX/e.observeFrequency),e.shiftOffsetVal){let t=e.firstX-e.shiftOffsetVal;e.firstX=e.firstX-t,e.lastX=e.lastX-t}}const C=/[, \t]+/;class U{}const q={keepRecordsRegExp:/^$/,canonicDataLabels:!0,dynamicTyping:!1,xy:!0,withoutXY:!1,chromatogram:!1,keepSpectra:!1,noContour:!1,nbContourLevels:7,noiseMultiplier:5,profiling:!1};function z(e,t){(t=Object.assign({},q,t)).wantXY=!t.withoutXY,t.start=Date.now();let r=[],n={profiling:!!t.profiling&&[],logs:[],entries:[]},o={children:[]},a=o,i=[],s=new U;if("string"!=typeof e)throw new TypeError("the JCAMP should be a string");R(n,"Before split to LDRS",t);let l=e.replace(/[\r\n]+##/g,"\n##").split("\n##");R(n,"Split to LDRS",t),l[0]&&(l[0]=l[0].replace(/^[\r\n ]*##/,""));for(let e of l){let o=e.indexOf("="),l=o>0?e.substring(0,o):e,u=o>0?e.substring(o+1).trim():"",f=l.replace(/[_ -]/g,"").toUpperCase();if("DATATABLE"===f){let e=u.indexOf("\n");if(-1===e&&(e=u.indexOf("\r")),e>0){let t=-1,r=-1,n=u.substring(0,e).split(/[ ,;\t]+/);if(n[0].indexOf("++")>0){let e=n[0].replace(/.*\(([a-zA-Z0-9]+)\+\+.*/,"$1"),o=n[0].replace(/.*\.\.([a-zA-Z0-9]+).*/,"$1");t=a.ntuples.symbol.indexOf(e),r=a.ntuples.symbol.indexOf(o)}-1===t&&(t=0),-1===r&&(r=0),a.ntuples.first&&(a.ntuples.first.length>t&&(s.firstX=a.ntuples.first[t]),a.ntuples.first.length>r&&(s.firstY=a.ntuples.first[r])),a.ntuples.last&&(a.ntuples.last.length>t&&(s.lastX=a.ntuples.last[t]),a.ntuples.last.length>r&&(s.lastY=a.ntuples.last[r])),a.ntuples.vardim&&a.ntuples.vardim.length>t&&(s.nbPoints=a.ntuples.vardim[t]),a.ntuples.factor&&(a.ntuples.factor.length>t&&(s.xFactor=a.ntuples.factor[t]),a.ntuples.factor.length>r&&(s.yFactor=a.ntuples.factor[r])),a.ntuples.units&&(a.ntuples.units.length>t&&(s.xUnit=a.ntuples.units[t]),a.ntuples.units.length>r&&(s.yUnit=a.ntuples.units[r])),s.datatable=n[0],n[1]&&n[1].indexOf("PEAKS")>-1?f="PEAKTABLE":n[1]&&(n[1].indexOf("XYDATA")||n[0].indexOf("++")>0)&&(f="XYDATA",s.deltaX=(s.lastX-s.firstX)/(s.nbPoints-1))}}if("XYDATA"!==f)if("PEAKTABLE"!==f)if("PEAKASSIGNMENTS"!==f){if("TITLE"===f){let e=a;e.children||(e.children=[]),a={spectra:[],ntuples:{},info:{}},e.children.push(a),i.push(e),r.push(a),a.title=u}else if("DATATYPE"===f)a.dataType=u,u.indexOf("nD")>-1&&(a.twoD=!0);else if("NTUPLES"===f)u.indexOf("nD")>-1&&(a.twoD=!0);else if("DATACLASS"===f)a.dataClass=u;else if("XUNITS"===f)s.xUnit=u;else if("YUNITS"===f)s.yUnit=u;else if("FIRSTX"===f)s.firstX=parseFloat(u);else if("LASTX"===f)s.lastX=parseFloat(u);else if("FIRSTY"===f)s.firstY=parseFloat(u);else if("LASTY"===f)s.lastY=parseFloat(u);else if("NPOINTS"===f)s.nbPoints=parseFloat(u);else if("XFACTOR"===f)s.xFactor=parseFloat(u);else if("YFACTOR"===f)s.yFactor=parseFloat(u);else if("MAXX"===f)s.maxX=parseFloat(u);else if("MINX"===f)s.minX=parseFloat(u);else if("MAXY"===f)s.maxY=parseFloat(u);else if("MINY"===f)s.minY=parseFloat(u);else if("DELTAX"===f)s.deltaX=parseFloat(u);else if(".OBSERVEFREQUENCY"===f||"$SFO1"===f)s.observeFrequency||(s.observeFrequency=parseFloat(u));else if(".OBSERVENUCLEUS"===f)s.xType||(a.xType=u.replace(/[^a-zA-Z0-9]/g,""));else if("$SFO2"===f)a.indirectFrequency||(a.indirectFrequency=parseFloat(u));else if("$OFFSET"===f)a.shiftOffsetNum=0,s.shiftOffsetVal||(s.shiftOffsetVal=parseFloat(u));else if("$REFERENCEPOINT"===f);else if("VARNAME"===f)a.ntuples.varname=u.split(C);else if("SYMBOL"===f)a.ntuples.symbol=u.split(C);else if("VARTYPE"===f)a.ntuples.vartype=u.split(C);else if("VARFORM"===f)a.ntuples.varform=u.split(C);else if("VARDIM"===f)a.ntuples.vardim=I(u.split(C));else if("UNITS"===f)a.ntuples.units=u.split(C);else if("FACTOR"===f)a.ntuples.factor=I(u.split(C));else if("FIRST"===f)a.ntuples.first=I(u.split(C));else if("LAST"===f)a.ntuples.last=I(u.split(C));else if("MIN"===f)a.ntuples.min=I(u.split(C));else if("MAX"===f)a.ntuples.max=I(u.split(C));else if(".NUCLEUS"===f)a.twoD&&(a.yType=u.split(C)[0]);else if("PAGE"===f){s.page=u.trim(),s.pageValue=parseFloat(u.replace(/^.*=/,"")),s.pageSymbol=s.page.replace(/[=].*/,"");let e=a.ntuples.symbol.indexOf(s.pageSymbol),t="";a.ntuples.units&&a.ntuples.units[e]&&(t=a.ntuples.units[e]),a.indirectFrequency&&"PPM"!==t&&(s.pageValue/=a.indirectFrequency)}else"RETENTIONTIME"===f?s.pageValue=parseFloat(u):N(f)?s[F(f)]=u:"SAMPLEDESCRIPTION"===f?s.sampleDescription=u:"END"===f&&(a=i.pop());if(a&&a.info&&f.match(t.keepRecordsRegExp)){let e=t.canonicDataLabels?f:l,r=u.trim();t.dynamicTyping&&!isNaN(r)&&(r=Number(r)),a.info[e]?(Array.isArray(a.info[e])||(a.info[e]=[a.info[e]]),a.info[e].push(r)):a.info[e]=r}}else t.wantXY&&(u.match(/.*(XYA).*/)&&Y(s,u),a.spectra.push(s),s=new U);else t.wantXY&&(k(s),X(s,u,n),a.spectra.push(s),s=new U);else t.wantXY&&(k(s),u.match(/.*\+\+.*/)?(s.deltaX||(s.deltaX=(s.lastX-s.firstX)/(s.nbPoints-1)),O(s,u)):X(s,u,n),a.spectra.push(s),s=new U)}return R(n,"Finished parsing",t),function(e,t,r){for(let n of e){if(Object.keys(n.ntuples).length>0){let e=[],t=Object.keys(n.ntuples);for(let r=0;r<t.length;r++){let o=t[r],a=n.ntuples[o];for(let t=0;t<a.length;t++)e[t]||(e[t]={}),e[t][o]=a[t]}n.ntuples=e}if(n.twoD&&r.wantXY&&(P(n,r),R(t,"Finished countour plot calculation",r),r.keepSpectra||delete n.spectra),r.chromatogram&&(r.xy=!0),r.xy&&r.wantXY&&n.spectra&&n.spectra.length>0)for(let e of n.spectra)if(e.data){let t=e.data,r={x:new Array(t.length/2),y:new Array(t.length/2)};for(let e=0;e<t.length;e+=2)r.x[e/2]=t[e],r.y[e/2]=t[e+1];e.data=r}r.chromatogram&&(n.spectra.length>1?M(n):D(n),R(t,"Finished chromatogram calculation",r))}}(r,n,t),R(n,"Total time",t),n.entries=o.children,n.flatten=r,n}function j(e){return{x:e[0],y:e[1]}}function _(e){var t=[],r=[];for(const n of e)t.push(n[0]),r.push(n[1]);return{x:t,y:r}}function $(e){var t=[],r=[];for(const n of e)t.push(n.x),r.push(n.y);return{x:t,y:r}}function G(e,t={}){const{inputFormat:r,outputFormat:n="xxyyObject"}=t;if(r===n)return e;let o;switch(r){case"xxyyArray":o=j(e);break;case"xyxyArray":o=_(e);break;case"xxyyObject":o=e;break;case"xyxyObject":o=$(e);break;default:o=function(e){if(Array.isArray(e))return 0===e.length?{x:[],y:[]}:Array.isArray(e[0])?2===e.length?j(e):_(e):$(e);if(Array.isArray(e.x)&&Array.isArray(e.x))return e;throw new TypeError("unknown data format")}(e)}switch(n){case"xxyyArray":return function({x:e,y:t}){return[e,t]}(o);case"xyxyArray":return function({x:e,y:t}){for(var r=[],n=0;n<e.length;n++)r.push([e[n],t[n]]);return r}(o);case"xxyyObject":return o;case"xyxyObject":return function({x:e,y:t}){for(var r=[],n=0;n<e.length;n++)r.push({x:e[n],y:t[n]});return r}(o);default:throw new TypeError("unknown output format ".concat(n))}}function W(e,t={}){return function(e,t={}){const{title:r="",owner:n="",origin:o="",type:a="",xUnit:i="",yUnit:s="",info:l={}}=t;let u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,c=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,h=[];for(let t=0;t<e.x.length;t++){let r=e.x[t],n=e.y[t];u>r&&(u=r),f<r&&(f=r),c>n&&(c=n),p<n&&(p=n),h.push("".concat(r," ").concat(n))}let m="##TITLE=".concat(r,"\n##JCAMP-DX=4.24\n##DATA TYPE=").concat(a,"\n##ORIGIN=").concat(o,"\n##OWNER=").concat(n,"\n##XUNITS=").concat(i,"\n##YUNITS=").concat(s,"\n##FIRSTX=").concat(u,"\n##LASTX=").concat(f,"\n##FIRSTY=").concat(c,"\n##LASTY=").concat(p,"\n");for(const e of Object.keys(l))m+="##$".concat(e,"=").concat(l[e],"\n");return"".concat(m,"##NPOINTS=").concat(h.length,"\n##PEAK TABLE=(XY..XY)\n").concat(h.join("\n"),"\n##END")}(G(e,{outputFormat:"xxyyObject"}),t)}function B(e){let t={xUnit:e.xLabel,yUnit:e.yLabel,title:e.title,type:"TGA",info:e.meta};return W({x:e.x,y:e.y},t)}function J(e,t,r={}){const{color:n="darkgrey"}=r;e.styles={unselected:{lineColor:n,lineWidth:1,lineStyle:1},selected:{lineColor:n,lineWidth:3,lineStyle:1}},e.label=t.id}e.Spectra=class{constructor(){this.data=[]}addSpectrum(e){let t=this.getSpectrumIndex(e.id);void 0===t?this.data.push(e):this.data[t]=e}removeSpectrum(e){let t=this.getSpectrumIndex(e);if(void 0!==t)return this.data.splice(t,1)}getSpectrumIndex(e){if(e)for(let t=0;t<this.data.length;t++){if(this.data[t].id===e)return t}}contains(e){return!isNaN(this.getSpectrumIndex(e))}},e.Spectrum=T,e.fromJcamp=function(e,t={}){let r=new T(t);return function(e,t){let r=z(t,{keepRecordsRegExp:/.*/,canonicDataLabels:!1,dynamicTyping:!0});for(let t of r.flatten){let r=t.spectra[0],n=r.xUnit,o=r.yUnit,a="";n.match(/\[.*C\]/)&&(a="weightVersusTemperature"),n.match(/\[.*s\]/)&&(a="weightVersusTime"),a&&e.set(r.data,{flavor:a,xLabel:n,yLabel:o,title:r.title})}}(r,e),r},e.fromPerkinElmer=function(e){let t=new T,r=function(e){let t=e.split(/[\r\n]+/),r={meta:{},data:{time:[],weight:[],temperature:[]}},n="",o=!1;for(let e of t){if(o)e.startsWith("1) TGA")?o=!1:(r.meta["Method Steps"]||(r.meta["Method Steps"]=""),r.meta["Method Steps"]+="".concat(e.replace(/\t/g,"  "),"\n"));else if(e.match(/^[a-zA-Z -]+$/))n=E(e);else if(e.match(/.*:.*/)){let t=e.indexOf(":"),o=e.substring(0,t),a=E(e.substring(t+1));r.meta[(n?"".concat(n,"_"):"")+o]=a}else if(e.match(/^[0-9\t .]+$/)){let t=e.replace(/^\t/,"").split("\t");r.data.time.push(Number(t[0])),r.data.weight.push(Number(t[1])),r.data.temperature.push(Number(t[4]))}e.startsWith("Method Steps:")&&(o=!0)}return r}(e);return t.set({x:r.data.temperature,y:r.data.weight},{xLabel:"Temperature [Â°C]",yLabel:"Weight [mg]",title:r.meta["Sample ID"],meta:r.meta,flavor:"weightVersusTemperature"}),t.set(r.data.time,r.data.weight,{xLabel:"Time [s]",yLabel:"Weight [mg]",title:r.meta["Sample ID"],meta:r.meta,flavor:"weightVersusTime"}),t},e.getJSGraph=function(e,t={}){let r=e.data||e;const{ids:n,colors:o,flavor:a,normalized:i}=t;let s={data:[]};for(let e=0;e<r.length;e++){const t=r[e];if(!n||n.includes(t.id)){let r=t.getData({flavor:a,normalized:i});if(!r)continue;J(r,t,{color:o[e]}),s.data.push(r)}}return s},e.toJcamp=function(e){let t=[],r=e.get("weightVersusTemperature");r&&t.push(B(r));let n=e.get("weightVersusTime");return n&&t.push(B(n)),t.join("\n")},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=tga-spectrum.min.js.map
